<!DOCTYPE HTML>


      
[%settitle Формат JSON%]
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
[%file newheader%]
</head>
<body>
[%file newnavbar%]

<div class="col-9">


<a name="json"> </a>
<h2>Представление ресурсов в JSON</h2>
<p>
Хотя FHIR-ресурсы описываются в спецификации, используя представления на основе XML, приводится и JSON-представление ресурсов. JSON-формат ресурсов в точности соответствует стандартному XML-формату, что делает взаимное преобразование простым, поэтому XPath-запросы могут быть легко преобразованы для работы с JSON-структурой. Формальный MIME-тип для этого формата – application/json+fhir.
</p>
<p>
Клиенты могут свободно выбирать в качестве формата реализации XML или JSON. Серверы ДОЛЖНЫ поддерживать XML и могут принять решение о поддержке JSON. Обратите внимание, что системы должны объявлять, какой формат(ы) они поддерживают, в своих <a href="conformance.html">Заявлениях о соответствии (Conformance Statement)</a>. 
</p>
<p>
Описание JSON-представления в сравнении с XML-представлением:
</p>
<ul>
 <li>Имена членов JSON-объекта соответствуют именам элементов и атрибутов в XML, включая элементы, которые могут повторяться. Имена свойств чувствительны к регистру.</li>
 <li>Как и в XML, атрибуты JSON-свойств никогда не содержат пустые значения; следует опустить значение, если оно пустое.</li>
 <li>В JSON символы табуляции не являются частью содержимого ресурса. Приложения могут сохранять символы табуляции во время обработки ресурсов, но не обязаны это делать. Обратите внимание, что от символов табуляции могут зависеть электронные цифровые подписи.</li>
</ul>

<p>Также имеются и различия:</p>
<ul>
 <li>В JSON-представлении нет пространств имен.</li>
 <li>Тип ресурса представляется в JSON по-другому.</li>
 <li>Порядок следования свойств объекта в JSON-представлении не имеет значения, хотя внутри массива порядок должен поддерживаться.</li>
 <li>JSON не имеет различия между понятиями атрибута и элемента, поэтому атрибуты (xml:id, value) обрабатываются иначе.</li>
 <li>JSON имеет систему обозначений для массивов, использующихся для представления повторяющихся элементов. Обратите внимание, что массивы используются, когда элемент может повторяться, даже если он не повторяется в данном случае.</li>
 <li>XHTML-элемент &lt;div&gt; в типе данных <a href="narrative.html">Narrative</a> представлен как отдельная экранированная строка XHTML. Это делается для того, чтобы избежать проблем в JSON со смешанным содержимым и проч. XHTML S все еще соответствует правилам, описанным для <a href="narrative.html">Narrative</a>.</li>
</ul>
<p>Эти различия – особенно с повторяющимся элементом, которого невозможно избежать – означают, что универсальные преобразователи XML --&gt; JSON не в состоянии выполнить операцию корректно. Эти <a href="downloads.html#refimpl">ссылочные платформы (reference platforms)</a> предлагают функциональность по преобразованию XML &lt;--&gt; JSON, которая учитывает эти специфичные для FHIR технические детали.</p>

<h3>JSON-представление для повторяющихся элементов</h3>

<p>
Элемент с максимальным кардинальным числом x..* может встречаться больше одного раза в экземпляре. В XML это делается простым повторением XML-элемента множество раз. В JSON это делается с помощью типа array. Обратите внимание, что:
</p>
<ul>
 <li>Имя массива указывается в единственном числе – так же как и XML-элемента.</li>
 <li>Элемент, который может повторяться, представляется в виде массива даже в том случае, если он не повторяется, чтобы процесс синтаксического разбора ресурса во всех случаях оставался одинаковым.</li>
 </ul>
<pre class="xml">
 &lt;<b>coding</b>&gt;
   &lt;<b>system</b> value="http://snomed.info/sct"/&gt;
   &lt;<b>code</b> value="104934005"/&gt;
 &lt;/<b>coding</b>/&gt;
 &lt;<b>coding</b>&gt;
   &lt;<b>system</b> value="http://loinc.org"/&gt;
   &lt;<b>code</b> value="2947-0"/&gt;
 &lt;/<b>coding</b>/&gt;
</pre>
<p>представляется в JSON как:</p>
<pre class="json">
 "coding": [
   {
     "system" : "http://snomed.info/sct",
     "code" : "104934005"
   },
   {
     "system" : "http://loinc.org",
     "code" : "2947-0"
   }
 ]
</pre>

<h3>JSON-представление примитивных элементов</h3>
<p>
FHIR-элементы с примитивными значениями представляются в двух частях:
</p>
<ul>
 <li>JSON-свойство с именем элемента, которое имеет JSON-тип числовой (number), логический (boolean) или строковый (string)</li>
 <li>JSON-свойство со знаком "_", добавленным в начало имени элемента, который, если присутствует, содержит xml:id и/или расширения.</li>
</ul>
<p>
FHIR-типы <a href="datatypes.html#integer">integer</a> и <a href="datatypes.html#decimal">decimal</a> представляются JSON-типом number, FHIR-тип <a href="datatypes.html#boolean">boolean</a>
 – как JSON boolean, а все остальные типы представляются как JSON-тип string, имеющий то же содержимое, что указано для соответствующего типа данных. Символы табуляции всегда являются значимыми (т. е. пробелы в начале и в конце для нестроковых типов не допускаются).</p>
<pre class="xml">
 &lt;<b>code</b> value="abc"/&gt; &lt;!-- code --&gt;
 &lt;<b>date</b> value="1972-11-30"/&gt; &lt;!-- dateTime --&gt;
 &lt;<b>deceased</b> value="false" /&gt; &lt;!-- boolean --&gt;
 &lt;<b>count</b> value="23" /&gt;  &lt;!-- integer --&gt;
</pre>
<p>в JSON представляется так:</p>
<pre class="json">
 "code" : "abc",
 "date" : "1972-11-30",
 "deceased" : false,
 "count" : 23
</pre>
<blockquote>
<p>При использовании JavaScript JSON.parse() реализации, имейте в виду, что JavaScript изначально поддерживает только один числовой тип данных, которым является число с плавающей точкой (floating point number). Это может привести к потере точности для чисел FHIR. Вы можете использовать пользовательскую программу синтаксического разбора (parser) и библиотеку больших чисел (например <a href="https://github.com/jtobey/javascript-bignum">https://github.com/jtobey/javascript-bignum</a>), если в этом имеется необходимость.</p>
</blockquote>
<p>
Если значение имеет атрибут id или расширения, то оно представляется следующим образом:
</p>
<pre class="xml">
 &lt;<b>dob</b> id="314159" value="1970-03-30" &gt;
   &lt;extension url="http://example.org/fhir/extensions#text"&gt;
     &lt;valueString value="Easter 1970"/&gt;     
   &lt;/extension&gt;
 &lt;/<b>dob</b>&gt;
</pre>
<p>в JSON представляется так:</p>
<pre class="json">
 "dob": "1972-11-30",
 "_dob": { 
   "id": "314159", 
   "extension": [{
      "url" : "http://example.org/fhir/extensions#text",
      "valueString" : "Easter 1970"
   }]
 }
</pre>
<p>Примечание: Если примитив имеет атрибут id или расширение, но не имеет value, то указывается только свойство со знаком "_".</p>
<p>
В случае, когда примитивный элемент может повторяться, это представляется двумя массивами. Для заполнения обоих массивов используется JSON-значение null,  чтобы привести в соответствие идентификатор и/или расширение с его значением в первом массиве, как продемонстрировано в этом примере:
</p>
<pre class="xml">
 &lt;<b>code</b> value="au"/&gt;
 &lt;<b>code</b> value="nz"&gt;
   &lt;extension url="http://hl7.org/fhir/Profile/tools-extensions#display"&gt;
     &lt;valueString value="New Zealand a.k.a Kiwiland"/&gt;     
   &lt;/extension&gt;
 &lt;/<b>code</b>&gt;
</pre>
<p>в JSON представляется так:</p>
<pre class="json">
 "code": [ "au", "nz" ],
 "_code": [ 
   null, 
   { "extension": [{
      "url" : "http://example.org/fhir/extensions#text",
      "valueString" : "New Zealand a.k.a Kiwiland"
   }] }
  ]
 }
</pre>
<p>Примечание: когда у одного из повторяющихся элементов нет значения (value), в первом массиве для него указывается значение null. Когда у элемента есть значение, но нет расширения/идентификатора, во втором массиве на месте этого элемента будет стоять null.</p>
<blockquote>
<p>
<b>Примечание разработчика</b>: Представление примитивных типов данных было разбито на две части с целью упрощения представления простых примитивных значений без идентификатора или расширений. Это действительно привело к издержкам, сделав представление атрибута id и расширений более неуклюжим, однако они оба редко используются с примитивными типами данных.
</p>
</blockquote>

<h3>JSON-представление элементов и сложных типов данных</h3>

<p>
Элементы и сложные <a href="datatypes.html">типы данных</a> (типы, содержащие именованные элементы других типов) представляются с помощью JSON-объекта, содержащего соответствующий элемент для каждого элемента в типе данных. Композиции могут иметь атрибуты id, которые преобразовываются в значения JSON-элементов объекта таким же способом, как описано для примитивов. Например:</p>
 <pre class="xml">
&lt;person&gt;
  &lt;text&gt;
    &lt;status value="generated" /&gt;
    &lt;div xmlns="http://www.w3.org/1999/xhtml"&gt;&lt;p&gt;...&lt;/p&gt;&lt;/div&gt;
  &lt;/text&gt;
  &lt;name&gt;
    &lt;use value="official" /&gt;  
    &lt;given value="Karen" /&gt;
    &lt;family id="a2" value="Van" /&gt;
  &lt;/name&gt;
&lt;/person&gt;
</pre>
<p>в JSON представляется так:</p>
<pre class="json">
{
  "person" : {
    "name" : [{
      "use" : "official" ,
      "given" : [ "Karen" ],
      "family" : [ "Van" ]
      "_family" : [ {"id" : "a2"} ]
     }],
    "text" : {
      "status" : "generated" ,
      "div" : "&lt;div xmlns=\"http://www.w3.org/1999/xhtml\"&gt;&lt;p&gt;...&lt;/p&gt;&lt;/div&gt;"
    }
}
</pre>
<p>На что здесь необходимо обратить внимание:</p>
<ul>
<li>И given, и family являются повторяющимися XML-элементами, поэтому они сериализуются в Array вне зависимости от того, повторяются они в данном случае или нет.</li>
<li>В части family элемента 'name' атрибут 'id' представлен в _family способом, описанным выше.</li>
<li>XHTML-содержимое элемента 'div', который есть в Narrative-элементе 'text', представлено в виде экранированной строки в JSON-свойстве value. Корневым элементом в XHTML должен быть &lt;div&gt; в пространстве имен XHTML.</li>
</ul>

<h3>JSON-представление ресурсов</h3>
<p>
Ресурс – это JSON-объект со свойством "resourceType", который сообщает программе-анализатору, какой это тип ресурса:
</p>
<pre class="json">
{
  "resourceType" : "Patient",
  "text" : {
    "status" : "generated" ,
    "div" : "&lt;div xmlns=\"http://www.w3.org/1999/xhtml\"&gt;&lt;p&gt;...&lt;/p&gt;&lt;/div&gt;"
  }
  etc...
}
</pre>
<p>
Обратите внимание, что синтаксические анализаторы не могут полагаться на то, что свойство resourceType будет идти первым.
</p>
<blockquote>
<p>
<b>Примечание разработчика</b>: Это является проблемой для некоторых сериализаторов вида JSON -&gt; Object , которые предполагают, что свойство resourceType действительно идет первым, включая <a href="http://james.newtonking.com/json">Json.NET</a>. 
Однако некоторые JSON-генераторы не дают авторским приложениям управлять порядком значений свойств, поэтому эти реализации не могут взаимодействовать с реализациями, которые делают предположения о порядке. Учитывая, что JSON заявляет, что значения свойств являются неупорядоченной таблицей пар name/value, данная спецификация не может требовать, чтобы свойства шли в каком-то определенном порядке, хотя реализаторы могут зафиксировать порядок свойств, если у них есть такая возможность (и ссылочные платформы, предоставленные в этой спецификации, делают это).
</p>
</blockquote>

<p>
Для помощи в тестировании JSON-анализаторов приводится <a href="json-edge-cases.json">файл с примером</a>, демонстрирующим многие крайние случаи.
</p>

<a name="bundle"> </a>
<a name="atom"> </a>
<a name="json-bundles"></a>
<h3>JSON-представление комплектов</h3>

<p>
В JSON <a href="extras.html#bundle">комплекты</a> представляются в помощью формата JSON, специально приспособленного к специфическим потребностям комплектов. Каждый элемент в определении XML-фида имеет соответствующий JSON-элемент объекта с таким же именем. Для удобства комплект имеет свойство "resourceType" со значением "Bundle" ("resourceType" используется для непротиворечивости с ресурсами, несмотря на то что комплект является не ресурсом, а контейнером ресурсов). Вот пример фида, возвращающего результаты запроса на поиск человека:
</p>

<pre class="json">
{
  &quot;resourceType&quot; : &quot;Bundle&quot;,
  &quot;title&quot; : &quot;Search result&quot;,
  &quot;updated&quot; : &quot;2012-09-20T12:04:45.6787909+00:00&quot;,
  &quot;id&quot; : &quot;urn:uuid:50ea3e5e-b6a7-4f55-956c-caef491bbc08&quot;,
  &quot;link&quot; : [{
    &quot;rel&quot; : &quot;self&quot;,
  &quot;href&quot; : &quot;http://ip-0a7a5abe:16287/fhir/person?format=json&quot;
  }],
 <a name="tags"> </a>&quot;category&quot; : [{
    &quot;term&quot; : &quot;[Tag Term]&quot;,
    &quot;label&quot; : &quot;[Tag Label]&quot;,
    &quot;scheme&quot; : &quot;[Tag Scheme]&quot;
  }],
  &quot;totalResults&quot; : 12,
  &quot;entry&quot; : [{
    &quot;title&quot; : &quot;Resource of type Person, with id = 1 and version = 1&quot;,
    &quot;link&quot; : [{
      &quot;rel&quot; : &quot;self&quot;,
      &quot;href&quot; : &quot;http://fhir.furore.com/fhir/person/@1/history/1&quot;
    }],
    &quot;id&quot; : &quot;http://fhir.furore.com/fhir/person/@1&quot;,
    &quot;updated&quot; : &quot;2012-05-29T23:45:32+00:00&quot;,
    &quot;published&quot; : &quot;2012-09-20T12:04:47.3012429+00:00&quot;,
    &quot;author&quot; : [{
      &quot;name&quot; : &quot;Grahame Grieve / HL7 publishing committee&quot;
    }],
    &quot;category&quot; : [{
      &quot;term&quot; : &quot;[Tag Uri]&quot;,
      &quot;label&quot; : &quot;[Tag Label]&quot;,
      &quot;scheme&quot; : &quot;[Tag Type]&quot;
    }],
    &quot;content&quot; : {
      &quot;resourceType&quot; : &quot;Patient&quot;,
      ...other Patient elements...
    },
    &quot;summary&quot; : &quot;&lt;div xmlns=\&quot;http://www.w3.org/1999/xhtml\&quot;&gt;(text summary)&lt;/div&gt;&quot;,
  },
  ... other entries ....
  ],
  &quot;signature&quot; : &quot;&lt;signature xmlns=\&quot;http://www.w3.org/2000/09/xmldsig\&quot;&gt;...&lt;/signature&gt;&quot;
}
</pre>

<p>
Обратите внимание, что имена свойств элементов, которые могут повторяться, не употребляются во множественном числе в целях непротиворечивости общего подхода (как описано выше). MIME-тип для JSON-комплекта – тоже application/json+fhir.
</p>

<a name="json-bundle-delete"> </a>
<h4>Объединение версий – удаление</h4>
<p>
При возвращении набора версий ресурса, версия может указывать на удаление. В то время как XML-формат следует <a href="http://www.rfc-editor.org/rfc/rfc6721.txt">RFC 6721</a>, JSON-формату необходимо использовать элемент записи для сохранения логической последовательности записей:</p>
<pre class="json">
   .. feed ..
   &quot;entry&quot; : [
    ... other entries ....,    
    {
      &quot;deleted&quot; : &quot;2012-05-29T23:45:32+00:00&quot;,
      &quot;id&quot; : &quot;http://fhir.furore.com/fhir/person/@1&quot;,
      &quot;link&quot; : [{
          &quot;rel&quot; : &quot;self&quot;,
          &quot;href&quot; : &quot;http://fhir.furore.com/fhir/person/@1/history/1&quot;
        }],
    }, ... other entries ....
  ]
  ... feed ...
</pre>
<p>
То, что запись была удалена, следует из даты ее удаления. ДОЛЖЕН быть указан идентификатор, и может быть приведена ссылка.
</p>

<a name="binary"> </a>
<h4>Бинарные ресурсы</h4>
<p>
Когда в JSON-комплекте используется <a href="extras.html#binary">бинарный ресурс</a>, он представляется в виде содержимого в кодировке base64 с content-type, соответствующим MIME-типу, в HTTP это будет указываться так:
</p>
<pre class="json">
{
  &quot;resourceType&quot; : &quot;Binary&quot;,
  &quot;contentType&quot; : &quot;[mime type]&quot;,
  &quot;content&quot; : &quot;[base64 of data]&quot;
}
</pre>

<a name="sig"> </a>
<h4>Подписи</h4>
<p>
Если комплект имеет подпись, то эта подпись имеет JSON-свойство "signature", а значение этого свойства – XML-строка, являющаяся допустимым <a href="http://www.w3.org/TR/2002/REC-xmldsig-core-20020212/#sec-Signature">XML-элементом signature</a>.
</p>

<pre class="json">
{
  &quot;resourceType&quot; : &quot;Bundle&quot;,
  ... metadata and entries as described above....
  &quot;signature&quot; : &quot;&lt;signature xmlns=\&quot;http://www.w3.org/2000/09/xmldsig\&quot;&gt;...&lt;/signature&gt;&quot;
}
</pre>

</div>

[%file newfooter%]
</body>
</html>