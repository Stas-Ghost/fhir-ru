<!DOCTYPE HTML>


      
[%settitle Extensibility%]
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
[%file newheader%]
</head>
<body>
[%file newnavbar%]


<div class="col-9">

<%extheader base%>

<a name="root"> </a>
<h1>Расширяемость</h1>
<p>
Данный стандарт обмена данными основывается на универсальных и общепринятых клинических требованиях, учитывает 
различные функциональные подходы, соответствует предметным областям здравоохранения и реалиям стран и территорий мира. Для конкретных реализаций характерно иметь действующие требования, которые не являются частью этих согласованных общепринятых требований. Стремление учесть все возможные требования в рамках одной спецификации сделало бы её слишком объёмной и труднореализуемой. Поэтому ожидается, что все специфические требования будут реализованы в элементах, являющихся расширениями ресурсов (extensions).
</p>
<p>
По существу, расширения - это фундаментальная часть проекта этой спецификации. Любой элемент ресурса может иметь элемент-потомок, 
являющийся его расширением (extension), для представления дополнительной информации, которая не входит в базовое 
определение ресурса (basic definition of the resource). Приложения не должны отказываться от обработки ресурса только
из-за наличия расширений, однако причиной отказа может служить содержимое расширения.
</p>
<p>
Обратите внимание, что, в отличие от других стандартов, FHIR не имеет "предрассудков" в отношении использования 
расширений каким-либо программным обеспечением, проектом или стандартом вне зависимости от учреждения или страны или 
территории, определяющей раcширение. Использование расширений позволяет спецификации FHIR сохранить свою простоту для 
каждого.
</p>
<p>
Для того чтобы сделать применение расширений безопасным и контролируемым, были приняты строгие правила их определения и 
использования. Хотя разработчики могут самостоятельно давать определения и использовать расширения, существует набор 
требований, соблюдение которых обязательно.
</p>
<a name="Extension"></a>
<a name="extension"></a>
<h2>Элемент "extension"</h2>
<p>
Все элементы в ресурсе или типы данных могут иметь неограниченное число необязательных элементов-потомков "extension". Ниже представлена модель содержимого расширения, применимая ко всем ресурсам:
</p>
<%dt Extension%>
<p>
Примечания:
</p>
<ul>
 <li><i>url</i> - это обязательный атрибут / свойство, который используется как идентификатор извлекаемого <a href="structuredefinition.html">extension definition</a>, применяемого по отношению к данному ресурсу и определяющего содержимое и семантику элемента расширения.</li>
 <li>Расширение ДОЛЖНО иметь либо значение (т. е. элемент value[x]), либо вложенные расширения, но не и то, и другое. Если присутствует, элемент value[x] ДОЛЖЕН иметь содерижмое (атрибует value или другие элементы)</li>
 <li>Если для приложения, обрабатывающего содержимое ресурса, не безопасно игнорировать расширение, это должно быть представлено по-другому (см. <a href="#modifier">ниже</a>)</li>
 <li>Фактическим именем элемента <i>value[x]</i> является слово "value", к которому добавляется с большой буквы имя одного из следующих определенных типов, а его содержимым будет то, которое определено для этого типа:
  <ul class="dense">
   <li><a href="datatypes.html#integer">Integer</a></li>
   <li><a href="datatypes.html#decimal">Decimal</a></li>
   <li><a href="datatypes.html#dateTime">DateTime</a></li>
   <li><a href="datatypes.html#date">Date</a></li>
   <li><a href="datatypes.html#instant">Instant</a></li>
   <li><a href="datatypes.html#string">String</a></li>
   <li><a href="datatypes.html#uri">Uri</a></li>
   <li><a href="datatypes.html#boolean">Boolean</a></li>
   <li><a href="datatypes.html#code">Code</a> (только если расширение предоставляет <a href="terminologies.html#code">фиксированную</a> привязку к допустимому набору кодов)</li>
   <li><a href="datatypes.html#base64Binary">Base64Binary</a></li>
   <li><a href="datatypes.html#Coding">Coding</a></li>
   <li><a href="datatypes.html#CodeableConcept">CodeableConcept</a></li>
   <li><a href="datatypes.html#Attachment">Attachment</a></li>
   <li><a href="datatypes.html#Identifier">Identifier</a></li>
   <li><a href="datatypes.html#Quantity">Quantity</a></li>
   <li><a href="datatypes.html#Range">Range</a></li>
   <li><a href="datatypes.html#Period">Period</a></li>
   <li><a href="datatypes.html#Ratio">Ratio</a></li>
   <li><a href="datatypes.html#HumanName">HumanName</a></li>
   <li><a href="datatypes.html#Address">Address</a></li>
   <li><a href="datatypes.html#ContactPoint">ContactPoint</a></li>
   <li><a href="datatypes.html#Timing">Timing</a></li>
   <li><a href="datatypes.html#Signature">Signature</a></li>
   <li><a href="references.html#Reference">Reference</a> - ссылка на другой ресурс</li>
  </ul>
 </li> 
</ul>
<div class="example">
<p>
Вот пример расширения в XML-формате:
</p>
<pre class="xml" fragment="HumanName">
&lt;name&gt;
  &lt;extension url=&quot;http://hl7.org/fhir/StructureDefinition/iso-21090-name-use&quot; &gt;
    &lt;valueCode value=&quot;I&quot; /&gt;
  &lt;/extension&gt;
  &lt;text value=&quot;Chief Red Cloud&quot;/&gt;
&lt;/name&gt;
</pre>
<p>
In this example, the name with text = "Chief Red Cloud" is extended to have a 
name use code of "Indigenous" (defined in ISO 21090, but very rarely used in 
practice).
</p>
<p>
В JSON-формате расширения описываются точно также:
</p>
<pre class="json" fragment="HumanName">
  "name" : {
    "extension" : [{
      "url" : "http://hl7.org/fhir/StructureDefinition/iso-21090-name-use",
        "valueCode" : "I"
     }],
     "text" : "Chief Red Cloud"
  }
</pre>
</div>
<p>
Явное указание типов в представлении означает, что все системы могут читать и писать (и, следовательно, хранить и/или обмениваться) расширениями корректно без необходимости доступа к определению расширения.
</p>
<p>
Расширения также могут содержать расширения либо потому, что определение расширения само описывает сложносоставное содержимое - то есть вложенное дерево значений в расширении, либо потому, что расширение расширено дополнительным расширением, определенным отдельно. 
</p>
<p>
В первом случае идентификаторы частей расширения являются локальными/относительными по отношению к определению расширения.
</p>
<div class="example">
<p>
В качестве примера давайте рассмотрим расширение ресурса "пациент" статусом принятия участия в клиническом исследовании тремя полями: статус, дата записи и человек, который зарегистрировал их (см. <a href="??">definition</a>). В XML:
</p>
<pre class="xml" fragment="Patient">
&lt;Patient&gt;
  &lt;extension url=&quot;http://acme.org/fhir/StructureDefinition/trial-status&quot; &gt;
    &lt;extension url=&quot;code&quot; &gt;	  
      &lt;valueCode value=&quot;unsure&quot; /&gt;	  
    &lt;/extension&gt;
    &lt;extension url=&quot;date&quot; &gt;	  
      &lt;valueDate value=&quot;2009-03-14&quot; /&gt;	  
    &lt;/extension&gt;
    &lt;extension url=&quot;registrar&quot; &gt;	  
      &lt;valueReference&gt;	  
        &lt;reference value=&quot;Practitioner/example&quot; /&gt;	  	    
      &lt;/valueReference&gt;	  
    &lt;/extension&gt;
  &lt;/extension&gt;
  &lt;!-- other data for patient --&gt;
&lt;/Patient&gt;
</pre>
<p>
Или в JSON:
</p>
<pre class="json" fragment="Patient">
{
  "resourceType" : "Patient",
  "extension" : [{
    "url" : "http://acme.org/fhir/StructureDefinition/trial-status",
    "extension" : [{ 
      "url" : "code",
      "valueCode" : "unsure"
    }, {
      "url" : "date", 
      "valueDate" : "2009-03-14" 
    },  {
      "url" : "registrar",
      "valueReference" : {
      "reference" : "Practitioner/example"
      }
    }]
  }]
  ... другие данные пациента ...
}
</pre>
</div>

<p>
Во втором случае вложенное расширение определяется отдельно.
</p>
<div class="example">
<p>
В этом случае регистратор был определен как отдельное расширение (например для более широкого использования), а не как часть расширения clinical-trial. URL-адрес расширения будет другим:
</p>
<pre class="xml" fragment="Patient">
&lt;Patient&gt;
  &lt;extension url=&quot;http://acme.org/fhir/StructureDefinition/trial-status&quot; &gt;
    &lt;extension url=&quot;code&quot; &gt;	  
      &lt;valueCode value=&quot;unsure&quot; /&gt;	  
    &lt;/extension&gt;
    &lt;extension url=&quot;date&quot; &gt;	  
      &lt;valueDate value=&quot;2009-03-14&quot; /&gt;	  
    &lt;/extension&gt;
    &lt;extension url=&quot;http://acme.org/fhir/StructureDefinition/registrar&quot; &gt;
      &lt;valueReference array="true"&gt;	  
        &lt;reference value=&quot;Practitioner/example&quot; /&gt;	  	    
      &lt;/valueReference&gt;	  
    &lt;/extension&gt;
  &lt;/extension&gt;
  &lt;!-- other data for patient --&gt;
&lt;/Patient&gt;
</pre>
<p>
или в JSON:
</p>
<pre class="json" fragment="Patient">
{
  "resourceType" : "Patient",
  "extension" : [{
    "url" : "http://acme.org/fhir/StructureDefinition/trial-status",
    "extension" : [{
      "url" : "code",
      "valueCode" : "unsure"
    }, {
      "url" : "date",
      "valueDate" : "2009-03-14" 
    }, {
      "url" : "http://acme.org/fhir/StructureDefinition/registrar",
      "valueReference" : {
      "reference" : "Practitioner/example"
      }
    }]
  }]
  ... другие данные пациента ...
}
</pre>
</div>

<a name="mustUnderstand"> </a>
<a name="isModifier"> </a>
<a name="modifierExtension"> </a>
<h2>Элементы-расширения, изменяющие значения ресурса (Modifier Extensions)</h2>
<p>
В некоторых случаях содержащаяся в расширениях информация изменяет значение родительского элемента. 
Обычно это означает, что элемент "extension" выполняет логическую функцию отрицания (negation) или уточняет (qualifier) 
значение родительского элемента. Рассмотрим некоторые примеры:
</p>
<ul>
 <li>С помощью элемента "extension" можно выразить <b>запрет</b> на прием лекарственного средства</li>
 <li>Элемент "extension" ресурса <a href="condition.html">Condition (Клиническое состояние)</a> позволяет сформировать запись, в которой говориться о том, что пациент <b>не</b> имеет какого-то конкретного диагноза (в отличие от опровержения)</li>
 <li>Элемент "extension" информирует о том, что исполнитель (performer) <b>не</b> принимал участие в выполнении<a href="procedure.html">процедуры (Procedure)</a></li>
 <li>Элемент "extension" декларирует дополнительную взаимосвязь категоризации для концепта в <a href="valueset.html">value set</a></li>
</ul>
<p>
В ходе реализации стандарта старайтесь избегать использования расширений-модификаторов. Случаи их 
использования должны быть продуманы, рассмотрены возможные негативные последствия. Часто использование уточняющих 
элементов обусловлено бизнес-требованиями и договоренностями об использовании ресурсов. Стандарт FHIR предлагает 
методологию для разрешения таких случаев.
Когда в ресурсе присутствует расширение-модификатор (Modifier Extension), нельзя быть уверенным в его корректной обработке приложением, если оно не содержит инструкций по его обработке. 
</p>
<p>
Стандарт FHIR разрешает выносить расширения-модификаторы (Modifier Extensions) в базовую структуру ресурса (at the base of 
the resource) или в структуру любого другого элемента, которому не соответствует какой-либо тип данных (например элементы, которые соответсвуют классам в UML-диаграммах ресурсов)
</p>
<p>
В XML эти элементы-модификаторы представлены с помощью элемента "modifierExtension", который имеет такое же содержимое, как и элемент <i>extension</i>, описанный выше:
</p>
<div class="example">
<p>
Пример: у ресурса <a href="medicationprescription.html">MedicationPescription</a> нет элемента, чтобы сделать "антипредписание" - инструкцию не принимать медикамент некоторое время. Классические системы медицинских записей не записывают это как предписание, а какая-то одна система записывает, и эти "антипредписания" необходимо совместно использовать в учреждении, где это происходит, так как они являются важной частью рабочего процесса. Поэтому приложениям разрешается расширять ресурс такими данными, как:
</p>
<pre class="xml">
&lt;MedicationPescription&gt;
  &lt;modifierExtension url=&quot;http://example.org/fhir/StructureDefinition/anti-prescription&quot;&gt;
    &lt;valueBoolean value="true"/&gt;
  &lt;/modifierExtension&gt;
  &lt;!-- ... other content ... --&gt;
&lt;/Procedure&gt;
</pre>
<p>
Или в JSON:
</p>
<pre class="json">
{
  "resourceType" : "MedicationPescription",
  "modifierExtension" : [{ 
    "url" : "http://example.org/fhir/StructureDefinition/anti-prescription",
    "valueBoolean" : "true"
      }],
  .. other content ... 
}
</pre>
</div>

<p>
Реализации стандарта, обеспечивающие обработку данных в ресурсах, ДОЛЖНЫ проверять наличие модификаторов везде, где они могут появиться, и если расширение-модификатор присутствует, ДОЛЖНЫ выполнить одно из следующих действий: 

</p>
<ol>
 <li>понять влияние расширения на использование данных</li>
 <li>отказаться обрабатывать эти данные</li>
 <li>выдать предупреждение относительно данных и любых действий или выходных данных, которые возникают в результате их обработки, чтобы проинформировать пользователей о неполном понимании информации источника</li>
</ol>
<p>
обработка данных ресурса обычно представляет собой копирование или фильтрацию данных ресурса для последующего их использования в ином контексте (для представления пользователю, 
в целях поддержки принятия решения, для частичного обмена данных в ином формате или их сохранения для этого вида использования). Серверы и фоновые 
процессы, которые обеспечивают простое перемещение данных без каких-либо изменений, не выполняют "обработку данных ресурса", а значит этим приложениям не требуется выполнять проверку наличия неизвестных расширений-модификаторов. 
</p>
<p>
<b>#1</b>: Если приложение понимает семантику расширения, это является результатом того, что разработчик подготовил соответствующие
инструкции по интерпретации содержимого с учетом существования расширения-модификатора.
</p>
<p><b>#2</b>: Это значит, что от конкретных реализаций, по сути, не требуется "поддерживать" расширение-модификатор любым существенным способом - они могут достигнуть этого понимания отклонением экземпляров, которые содержат это расширение. Приложения могут также игнорировать расширение-модификатор, если знают, что это безопасно делать в своем собственном контексте, хотя это не будет, как правило, иметь место.
</p>
<p> 
Обратите внимание, что конкретные реализации могут иметь возможность быть уверенными благодаря их среде реализации (например особое соглашение торговых партнеров), что расширения-модификаторы никогда не будут использоваться, и, следовательно, выполнить требование проверки наличия модификаторов уже на стадии проектирования. Тем не менее, так как условия интеграции и внедрения часто изменяются впоследствии, приложениям всё равно СЛЕДУЕТ всегда проверять наличие расширений-модификаторов при обработке ресурсов.
</p>

<p><b>#3</b>: 
Один из способов предупредить пользователя - это загрузить определение расширения по имеющемуся URL и затем использовать заданный элемент display name для представления расширения пользователю. Сообщение об ошибке может выглядеть так:
</p>
<img src="modifier-extension-warning.png"/>
<p>
Обратите внимание: описательная (человекочитаемая) часть ресурса (narrative) ДОЛЖНА содержать эту уточняющую информацию, чтобы её можно было безопасно показать пользователю в качестве выражения содержимого ресурса.  Диалоговое окно с предупреждением можно расширить и предложить пользователю просмотреть оригинальный текст описательной части ресурса.  
</p>
<div class="example">
<p>
Вот пример предписания, приведенного выше, с описательной частью:
</p>
<pre class="xml">
&lt;MedicationPescription xmlns=&quot;http://hl7.org/fhir&quot;&gt;
  &lt;text&gt;
    &lt;status value=&quot;generated&quot;/&gt;
    &lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
      &lt;p&gt;&lt;b&gt;Note: This prescription is an instruction NOT to take a medication&lt;/b&gt;&lt;/p&gt;
      &lt;!-- snip actual narrative --&gt;
    &lt;/div&gt;
  &lt;/text&gt;
  &lt;!-- ...data... --&gt;
  &lt;modifierExtension url=&quot;http://example.org/fhir/StructureDefinition/anti-prescription&quot;&gt;
      &lt;boolean value="true"/&gt;
    &lt;/modifierExtension&gt;
  &lt;!-- ...data... --&gt;
&lt;/MedicationPescription&gt;
</pre>
</div>
<p>
Приложение должны интересовать modifierExtensions только на тех элементах, которые она обрабатывает. Возьмем, к примеру, тот случай выше, где в ресурсе procedure на одном из элементов performer есть modifierExtension, обозначающее, что они не участвовали в этой процедуре. В этом случае, если приложение не использует информацию о performer вообще, тот факт, что один из элементов performer содержит modifierExtension, будет несущественным и приложение может свободно игнорировать его. Если оно всё же обрабатывает элементы performer и встречает модифицирующее расширение, оно должно действовать одним из перечисленных выше способов.
</p>

<h3>Резюме: Правила обеспечения соответствия для Modifier Extensions</h3>
<ul>
 <li>Расширения-модификаторы ДОЛЖНЫ влиять только на тот элемент и/или потомки этого элемента, который их содержит</li>
 <li>Всегда ДОЛЖНО быть безопасно показать описательную часть людям; все расширения-модификаторы дОЛЖНЫ быть представлены в этой описательной части</li>
 <li>Приложения всегда ДОЛЖНЫ проверять наличие расширений-модификаторов при обработке данных из любого элемента, который может их содержать</li>
 <li>Если присутствует расширение-модификатор, который они не понимают, приложение ДОЛЖНО либо отказаться обрабатывать такой ресурс или затронутый элемент, либо выдать соответствующее предупреждение своим пользователям</li>
</ul>

<h3>Особый случай: Отсутствие данных</h3>
<p>
В некоторых случаях разработчики могут обнаружить, что у них нет данных для элемента с минимальным кардинальным числом = 1. В таком случае элемент обязательно должен присутствовать, но пока ресурс или соответствующий ему интеграционный профиль не потребует наличия реального значения (соответствующего простым типам данных), такой элемент может иметь расширение, объясняющее, почему значение примитивного типа отсутствует. 
</p>
<pre class="xml">
&lt;uri&gt;
  &lt;extension url=&quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;&gt;
    &lt;code=&quot;unknown&quot;/&gt;
  &lt;/extension&gt;
&lt;/uri&gt;
</pre>
<p>
В данном примере вместо значения (value) указывается <a href="general-extensions.html">код отсутствия данных (data missing code)</a>. 
Обратите внимание, что использование расширения такого типа необязательно. Данный элемент-расширение <b>нельзя</b> считать модификатором
(modifier extension), т. к. ему не присваиваются значения, соответствующие примитивным типам данных. 
</p>
<p>
Неправильно создавать формальное наполнение элемента (fictional piece of data) с содержимым, соответствующим примитивным типам данных, а затем включать в элемент расширение, определяющее добавление данных в целях обеспечения соответствия. Данное решение было бы неправильным еще и потому, что недопустимо использовать элемент "modifierExtension" для уточнения типов данных.
</p>

<a name="exchange"> </a>
<h2>Обмен расширениями</h2>

<p>Элементы-расширения позволяют отражать локальные потребности здравоохранения с помощью подхода, основанного на универсальной [модели] информации. Это необходимо, чтобы медицинские системы могли работать с ресурсами с помощью одинаковых средств и инструментов. Однако, когда речь идет об обработке информации (содержищейся в ресурсах и уточненной расширениями), приложения будут ограничены в обработке расширений в той степени, в которой они располагают данными о них.
</p>
<p>
Несмотря на то, что каждое выражение (expression) должно сопровождаться описанием его структуры (structure definition) (см. далее подробности), само по себе наличие описания не означает, что приложение понимает, как правильно обрабатывать расширение. В целом, всегда требуется решение человека, который определит, каким образом будут использоваться данные, содержащиеся в элементах-расширениях, и какие обязательства в отношении данной информации должны выполняться.
</p>
<p>
По этой причине локальные потребности, которые находят отражение в форме расширений, препятствуют интеграции.
Чем больше требований являются универсальными (например на региональном или общегосударственном уровне), тем меньшее
влияние они оказывают на процессы интеграции. Согласованное представление, определение и регистрация расширений, 
описанных в данной спецификации, не поможет решить существующую проблему. Необходима методология, которая упростит работу с локальными вариантами ресурсов. 
</p>
<p>
Внедрение медицинских приложений, обеспечивающих поддержку локальных потребностей, часто сопровождается ситуацией,
при которой обменивающиеся информацией приложения поддерживают разные наборы расширений. Спецификация FHIR
устанавливает ряд простых правил, направленных на управления такими ситуациями, однако не способна предложить решения
для такого рода несоответствий.
</p>
<ul>
 <li>При обмене ресурсами системы МОГУТ, по возможности, сохранять неизвестные расширения (так же как и базовые элементы ресурса)</li>
 <li>Если система изменяет ресурс, она МОЖЕТ удалить любые расширения, семантика которых для нее непонятна. Необходимо
 удалять элемент-модификатор и все его элементы-потомки, потому что изменения, вносимые в ресурс, могут сделать
 элемент-расширение некорректным</li>
 <li>Системы, удаляющие (drop) существующие элементы, занимаются "обрабаткой ресурса" ("processing the resource")</li>
 <li>Система НЕ ДОЛЖНА изменять ресурсы или элементы, которые содержат элементы-модификаторы с неясной семантикой  
 </li>
 <li>Приложения МОГУТ игнорировать расширения с неясной семантикой, если эти расширения не изменяют значение родительского элемента
 </li>
 <li>Системы, которые не принимают (к обработке) неизвестные расширения, ДОЛЖНЫ указывать это в экземплярах ресурсов, обеспечивающих соответствие (Conformance resource instance)
 </li>
</ul>
<p>
То, в какой степени приложения должны сохранять неизвестные элементы-расширения зависит от функциий, которые они 
выполняют: FHIR-сервер общего назначения или промежуточная платформа (middleware engine) сохраняют все расширения, в то 
время, как приложения, используемые для управления данными пациентов (последством пользовательского интерфейса) 
при регистрации, сохраняют только те, из неизвестных расширений, которые входят в набор информации, 
непосредственно обрабатываемой пользователем.
</p>

<h3>Summary: Handling extensions</h3>
<p>
Используйте следующие правила в качестве руководства для обработки ресурсов:
</p>
<ul>
 <li>При написании расширений убедитесь, что они имеют [формализованное] описание и находятся в открытом доступе</li>
 <li>При чтении, навигации или поиску по элементам, которые могут иметь расширения-модификаторы, проверяйте, имеются ли они</li>
 <li>При чтении элементов читайте и обрабатывайте расширения, которые вам известны, и игнорируйте другие расширения
 </li>
 <li>Фиксируйте расширения, где это возможно</li>
</ul> 
 
</div>

[%file newfooter%]


  <script src="external/jquery/jquery.js"> </script>
<script src="jquery-ui.min.js"> </script>
<script>
 try {
   var currentTabIndex = sessionStorage.getItem('fhir-resource-tab-index');
 } catch(exception){ 
  if (navigator.userAgent.toLowerCase().indexof('msie') == -1)
    alert(exception);
 }
 if (!currentTabIndex)
   currentTabIndex = '0';

$( '#tabs-Extension' ).tabs({ active: currentTabIndex, activate: function( event, ui ) { store(ui.newTab.index()); } });
     
     
function store(currentTab) {
  try {
    sessionStorage.setItem('fhir-resource-tab-index', currentTab);
  } catch(exception){ 
  if (navigator.userAgent.toLowerCase().indexof('msie') == -1)
    alert(exception);
  }
  $( '#tabs-Extension' ).tabs('option', 'active', currentTab);
}     
</script>

</body>
</html>
