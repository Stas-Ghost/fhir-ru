<!DOCTYPE HTML>


      
[%settitle Extensibility%]
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
[%file newheader%]
</head>
<body>
[%file newnavbar%]


<div class="col-9">


<a name="root"> </a>
<h1>Расширяемость</h1>
<p>
См. также <a href="extensibility-examples.html">Примеры расширяемости</a>.
</p>
<p>
Данный стандарт обмена данными основывается на универсальных и общепринятых клинических требованиях, учитывает 
различные функциональные подходы, соответствует предметным областям здравоохранения и реалиям стран и территорий мира. 
Вследствие универсальности FHIR, конкретные требования отдельных субьектов здравоохранения к стандарту информационного 
обмена могут оставаться неучтенными. Стремление учесть все возможные требования в рамках одной спецификации,
сделало бы ее слишком объемной и труднореализуемой. Поэтому, ожидается, что все специфические требования будут реализованы
в элементах, являющихся расширениями ресурсов (extensions).
<!--This exchange specification is based on generally agreed common requirements across healthcare - covering many 
jurisdictions, domains, and different functional approaches. As such, it is common for specific implementations to have 
valid requirements that will not be directly included in this specification. Incorporating all of these requirements 
would make this specification very cumbersome and difficult to implement. Instead, this specification expects that 
these additional distinct requirements will be implemented as extensions.-->
</p>
<p>
Расширения - это одна из главных частей стандарта FHIR. Каждый элемент ресурса может иметь элемент-потомок, 
являющийся его расширением (extension), для представления дополнительной информации, которая не входит в базовое 
определение ресурса (basic definition of the resource). Приложения не должны отказываться от обработки ресурса только
из-за наличия расширений, однако, причиной отказа может служить содержимое расширения.
<!-- As such, extensibility is a fundamental part of the design of this specification. Every element in a resource may have 
extension child elements to represent additional information that is not part of the basic definition of the resource. 
Applications should not reject resources merely because they contain extensions, though they may need to reject resources 
because of the specific contents of the extensions. -->
</p>
<p>
Обратите внимание, что, в отличие от других стандартов, FHIR не имеет "предрассудков" в отношении использования 
расширений каким-либо программным обеспечением, проектом или стандартом вне зависимости от учреждения или страны или 
территории, определяющей раcширение. Использование расширений позволяет спецификации FHIR сохранить свою простоту для 
каждого.
<!--Note that, unlike in many other specifications, there can be no stigma associated with the use of extensions by any 
pplication, project, or standard - regardless of the institution or jurisdiction that uses or defines the extensions. 
he use of extensions is what allows the FHIR specification to retain a core simplicity for everyone. -->
</p>
<p>
Для того, чтобы сделать применений расширений безопасным и контролируемым, были приняты строгие правила их определения и 
использования. Хотя, разработчики могут самостоятельно давать определение и использовать расширения, существует набор 
требований, соблюдение которых обязательно.
<!--In order to make the use of extensions safe and manageable, there is a strict governance applied to the definition 
and use of extensions. Though any implementer is allowed to define and use extensions, there is a set of requirements 
that must be met as part of their use and definition. -->

</p>
<a name="Extension"></a>
<a name="extension"></a>
<h2>Элемент "extension"</h2>
<p>
Все элементы в ресурсе или типы данных могут иметь неограниченное число необязательных элементов-потомков "extension". 
Элементы "extension" являются первоочередными элементами-потомками и размещаются в теле ресурса раньше других 
элементов-потомков. Ниже представлена модель содержимого, применимая ко всем ресурсам:
</p>
<%dt Extension%>
<p>
Замечания:
</p>
<ul>
 <li><i>url</i> - это обязательный атрибут / свойство, который используется как идентификатор описания элемента расширения 
 (extension definition) в <a href="profile.html">интеграционном профиле</a>, применяемом по отношению к данному ресурсу и определяющем содержимое и 
 семантику элемента расширения. </li>
 <li>Фактическим содержимым элемента "extension" может быть некоторое (единственное) значение, 
 заключенное в элементе value[x] или дополнительные элементы "extension", с обязательными определяющими атрибутами "url" и 
 собственным содержимым.</li>
 <li>Элемент "extension" ДОЛЖЕН иметь некоторое значение (напр., в элементе "value[x]") или элементы-потомки. Элемент "value[x]" ДОЛЖЕН содержать некоторое значение и/или атрибут id, на который ссылается запись из описательной "человекочитаемой" части ресурса (Narrative).</li>
 <li>Когда на элемент "extension" ссылается некоторая внутренняя ссылка, то она всегда ссылается на содержащееся в этом элементе значение. Ссылка на расширение возможна только в том случае, если оно не содержит элемента "value[x]"</li>
 <li>Для большей части расширений вполне допустима обработка содержимого ресурса без учета содержимого расширений. В частности, это следует понимать следующим образом - содержимое расширения не изменяет значения содержащего его элемента.</li>
</ul>
<p>
В элементе <i>value[x]</i>, [x] заменяется на имя одного из заданных типов данных (имя должно начинаться с заглавной буквы)
и содержимое, соответствующее заданному типу. Возможны следующие типы данных:
</p>
<ul class="dense">
 <li><a href="datatypes.html#integer">integer</a></li>
 <li><a href="datatypes.html#decimal">decimal</a></li>
 <li><a href="datatypes.html#dateTime">dateTime</a></li>
 <li><a href="datatypes.html#date">date</a></li>
 <li><a href="datatypes.html#instant">instant</a></li>
 <li><a href="datatypes.html#string">string</a></li>
 <li><a href="datatypes.html#uri">uri</a></li>
 <li><a href="datatypes.html#boolean">boolean</a></li>
 <li><a href="datatypes.html#code">code</a> (только если расширение предоставляет <a href="terminologies.html#code">фиксированную</a> привязку к допустимому набору кодов)</li>
 <li><a href="datatypes.html#base64Binary">base64Binary</a></li>
 <li><a href="datatypes.html#Coding">Coding</a></li>
 <li><a href="datatypes.html#CodeableConcept">CodeableConcept</a></li>
 <li><a href="datatypes.html#Attachment">Attachment</a></li>
 <li><a href="datatypes.html#Identifier">Identifier</a></li>
 <li><a href="datatypes.html#Quantity">Quantity</a></li>
 <li><a href="datatypes.html#Range">Range</a></li>
 <li><a href="datatypes.html#Period">Period</a></li>
 <li><a href="datatypes.html#Ratio">Ratio</a></li>
 <li><a href="datatypes.html#HumanName">HumanName</a></li>
 <li><a href="datatypes.html#Address">Address</a></li>
 <li><a href="datatypes.html#Contact">Contact</a></li>
 <li><a href="datatypes.html#Schedule">Schedule</a></li>
 <li><a href="references.html#ResourceReference">Resource</a> - ссылка на другой ресурс</li>
</ul>

<p>
Вместо значения, элемент "extension" содержит в себе другие элементы-расширения, если в исходном описании расширения 
определяется комплексное содержимое (например, расширение состоит из нескольких элементов вместо данных 
простого типа). Если значение элемента "extension" также нуждается в расширении, то оно будет размещаться внутри 
элемента value[x].
</p>
<div class="example">
<p>
Приведем пример имени с простым расширением - "племенным именем" (tribal name):
</p>
<pre class="xml" fragment="HumanName">
&lt;name&gt;
  &lt;extension url=&quot;http://hl7.org/fhir/Profileiso-21090#name-use&quot; &gt;
    &lt;valueCode value=&quot;I&quot; /&gt;
  &lt;/extension&gt;
  &lt;text value=&quot;Chief Red Cloud&quot;/&gt;
&lt;/name&gt;
</pre>
<p>
или в JSON:
</p>
<pre class="json">
"name" : {
  "extension: [
    {
      "url" : "http://hl7.org/fhir/Profileiso-21090#name-use",
      "valueCode" : "I"
     }]
  "text": "Chief Red Cloud"/>
}
</pre>
<p>
Обсудим корректное использование атрибута "URL".
</p>
<p>
Рассмотрим расширение ресурса "Patient" путем добавления статуса "согласие на участие"
с тремя полями: статус (status), дата записи статуса (date of recording), лицо, зафиксировавшее статус 
(person who recorded):
</p>
<pre class="xml" fragment="Patient">
&lt;Patient&gt;
  &lt;extension url=&quot;http://acme.org/fhir/Profile/main#trial-status&quot; &gt;
    &lt;extension url=&quot;http://acme.org/fhir/Profile/main#trial-status-code&quot; &gt;	  
      &lt;valueCode value=&quot;unsure&quot; /&gt;	  
    &lt;/extension&gt;
    &lt;extension url=&quot;http://acme.org/fhir/Profile/main#trial-status-date&quot; &gt;	  
      &lt;valueDate value=&quot;2009-03-14&quot; /&gt;	  
    &lt;/extension&gt;
    &lt;extension url=&quot;http://acme.org/fhir/Profile/main#trial-status-who&quot; &gt;	  
      &lt;valueResource&gt;	  
        &lt;reference value=&quot;Practitioner/example&quot; /&gt;	  	    
      &lt;/valueResource&gt;	  
    &lt;/extension&gt;
  &lt;/extension&gt;
  &lt;!-- other data for patient --&gt;
&lt;/Patient&gt;
</pre>
<p>
или в JSON:
</p>
<pre class="json">
{
  "resource-type" : "Patient",
  "extension" : [
    {
      "url" : "http://acme.org/fhir/Profile/main#trial-status",
      "extension" : [
        {
          "url" : "http://acme.org/fhir/Profile/main#trial-status-code",
          "valueCode" : "unsure"
        }, 
        {
          "url" : "http://acme.org/fhir/Profile/main#trial-status-date",
          "valueDate" : "2009-03-14"
        }, 
        {
          "url" : "http://acme.org/fhir/Profile/main#trial-status-who",
          "valueResource" : {
            "reference" : "Practitioner/example"
          }
        }
     ]
   }
  ], 
  ... other data for patient... 
}
</pre>

</div>

<a name="mustUnderstand"> </a>
<a name="isModifier"> </a>
<a name="modifierExtension"> </a>
<h2>Элементы-расширения, изменяющие значения ресурса (Modifier Extensions)</h2>
<p>
В некоторых случаях, содержащаяся в расширениях информация изменяет значение родительского элемента. 
Обычно, это означает, что элемент "extension" выполняет логическую функцию отрицания (negation) или уточняет (qualifier) 
значение родительского элемента. Рассмотрим некоторые примеры:
</p>
<ul>
 <li>Расширение, характеризующее вероятность <a href="adversereaction.html">нежелательной реакции (Adverse Reaction)</a> может иметь значение "highly doubtful" (маловероятно)</li>
 <li>Позволяет вводить дополнительную категоризацию концепта, входящего в<a href="valueset.html"> набор значений (value set)</a></li>
 <li>С помощью элемента "extension" можно выразить <b>запрет</b> на прием лекарственного средства</li>
 <li>Элемент "extension" ресурса <a href="condition.html">Condition (Клиническое состояние)</a> позволяет сформировать запись, в которой говориться о том, что пациент <b>не</b> имеет конкретного диагноза</li>
 <li>Элемент "extension" информирует о том, что исполнитель (performer) <b>не</b> принимал участие в выполнении<a href="procedure.html">процедуры (Procedure)</a></li>
 <li>Элемент "extension" информирует о том, что <a href="supply.html">акт снабжения (Supply)</a> <b>не</b> состоялся (напр., отказано в выдаче)</li>
</ul>
<p>
В ходе реализации стандарта старайтесь избегать использования элементов, изменяющих значение ресурса. Случаи их 
использования должны быть продуманы, рассмотрены возможные негативные последствия. Часто использование уточняющих 
элементов обусловлено бизнес-требованиями и договоренностями об использовании ресурсов. Стандарт FHIR предлагает 
методологию для разрешения спорных ситуаций, требующих использование модификаторов.
<!--Implementers should avoid the use of modifier extensions where possible. Any use should be carefully considered 
against its possible downstream consequences. However, implementers are often forced into these situations by the 
business arrangements around the use of resources, so this specification creates a framework for handling these.-->

</p>
<p>
Когда в ресурсе присутствует элемент-расширение, изменяющий значение родительского ресурса (Modifier Extension), 
нельзя быть уверенным в его корректной обработке приложением (если оно не содержит инструкций по его обработке). 
Стандарт FHIR разрешает выносить элементы-модификаторы (Modifier Extensions) в базовую структуру ресурса (at the base of 
the resource) или в структуру любого другого элемента, которому не соответствует какой-либо тип данных (например, 
элементы, которые соответсвуют классам в диаграммах ресурсов UML), с помощью элемента "modifierExtension". 
Функция и содержимое элемента "modifierExtension" совпадает с содержимым элементов "extension".
<!-- If modifier extensions are present, an application cannot safely process the resource unless it knows what the 
extension means for its own use of the data. This specification allows for such modifier elements to be included at the 
base of a resource or in any elements that do not have a data type (e.g. the elements that correspond to classes in the 
resource UML diagrams), using an element named "modifierExtension", which has same content as the extension element 
documented above.  -->
</p>
<p>
Конкретные реализации стандарта, обеспечивающие обработку клинических данных, ДОЛЖНЫ понимать то, как сильно 
элементы-расширения могут изменить значение ресурса. Если приложение, обрабатывающее содержимое ресурса, 
не может определить значение "modifierExtension" и данных элемента, которые являются для него родительскими (??), оно 
ДОЛЖНО отказаться от обработки всего элемента и предупредить пользователя о неполном понимании ресурса.
<!-- Implentations processing the data in resources SHALL understand the impact of the extension when using the data. 
If an application processing the content of a resource does not recognize a modifierExtension and the data from the 
element it extends is processed by the application, the application SHALL either refuse to process the data or carry a 
warning concerning the data along with any action or output that results from processing the data to inform users that 
it has not fully understood the source information. -->
</p>
<p>
Конкретные реализации стандарта не обязаны "поддерживать" семантическую обработку (meaningful use) данных, содержащихся в 
элементах-расширениях, поэтому разрешается игнорировать все экземпляры ресурсов, которые их содержат. 
Альтернативным решением станет отказ от использования расширений, утвержденный на уровне конкретной 
технологической платформы, в которой используется реализация стандарта FHIR.
<!-- Implementations are not required to "support" the extension in any meaningful way - they may achieve this 
understanding by rejecting instances that contain this extension. Alternatively, implementations may be able to be 
sure, due to their implementation environment, that such extensions will never occur. However applications SHOULD 
always check for extensions irrespective of this. -->
</p>
<p>
Обратите внимание на то, что обработка данных ресурса, обычно представляет собой копирование или фильтрацию данных 
(data filtering) ресурса для последующего их использования в ином контексте (т.е. для представления пользователю, 
в целях поддержки принятия решения, для частичного обмена данных в ином формате или хранения). Серверы и фоновые 
процессы (backgroud processes), которые обеспечивают простое перемещение данных без каких-либо изменений, не выполняют 
обработку данных, а значит могут не выполнять проверку наличия расширений.
<!-- Note that processing the data of a resource typically means copying or filtering data out of a resource for use in 
another context (display to a human, decision support, exchange in another format where not all information is included,
or storing it for this kind of use). Servers and background processes that simply move whole resources around unchanged
are not "processing the data of the resource", and therefore these applications are not required to check for unknown
extensions. -->
</p>
<h3>Обзорная информация: Правила соответствия (Conformance Rules) для элементов-расширений, изменяющих значение родительского элемента (Modifier Extensions)</h3>
<ul>
 <li>Элемент "modifierExtension" может изменять значение ТОЛЬКО элементов-потомков</li>
 <li>(??)It SHALL always be safe to show the narrative to humans; any modifier extension SHALL be represented in the narrative.</li>
 <li>Приложения всегда ДОЛЖНЫ проверять элементы ресурса на наличие "modifierExtension". Если приложение не в состоянии интерпретировать данные из "modifierExtension", то оно
 должно отказаться от обработки ресурса (его содержащего) или предоставить пользователю соответствующее оповещение</li>
</ul>
<!-- 
A modifierExtension SHALL only modify the element which it contains and/or its children
It SHALL always be safe to show the narrative to humans; any modifier extension SHALL be represented in the narrative.
Applications SHALL always check for modifierExtensions when processing the data from any element that may carry one. 
If a modifierExtension they do not understand is found, the application SHALL either refuse to process the resource or
affected element, or provide an appropriate warning to its users
-->

<h3>Пример</h3>
 
<div class="example">
<p>
Пример: Из-за отсутствия договоренности (между медицинскими специалистами) не существует элемента ресурса 
<a href="procedure.html">Procedure (процедура)</a>, для отражения достоверности проявления аллергической реакции 
или непереносимости (Allergy/Intolerance). Некоторые системы используют [уточняющие] записи "unlikely" (маловероятно) 
или "probable" (вероятно, возможно). Приложениям разрешается расширять содержимое ресурса подобными записями:
<!--Example: Because of a lack of clinical consensus, there's no element on Procedure for any expression of certainty 
around the expression of the Allergy/Intolerance. Some systems mark their entries as "unlikely" or "probable". 
Applications are allowed to extend a resource with data like this:  -->
</p>
<pre class="xml">
&lt;AllergyIntolerance&gt;
  &lt;modifierExtension&gt;
    &lt;url value=&quot;http://example.org/fhir/extensions#certainty&quot; /&gt;
    &lt;valueCoding&gt;
      &lt;system value="http://example.org/codes/certainty"/&gt;
      &lt;code value="2"/&gt;
      &lt;display value="Unlikely"/&gt;
    &lt;/valueCoding&gt;
  &lt;/modifierExtension&gt;
  &lt;!-- .. text etc... --&gt;
&lt;/AllergyIntolerance&gt;
</pre>
</div>
<p>
Если приложение понимает семантику расширения, это является результатом того, что разработчик подготовил соответствующие
инструкции по интерпретации содержимого расширений. Обратите внимание - не существует требования обязательной обработки 
данных приложением. Оно может проигнорировать расширение, если это безопасно в контектсе данного расширения.
<!--When an application understands this extension, it means that some developer has provided appropriate instructions 
for what to do with the data contained in it. Note that there is no obligation that the application do anything at all 
with the data - it can ignore it if that is safe in its own context, though this would not usually be the case. -->
</p>
<p>
При попытке обработки ресурса приложением, неспособным корректно его интерпретировать, необходимо отказаться от 
обработки ресурса (или содержащихся в нем элементов) или уведомить пользователя о возникших проблемах. 
Оба варианта предложенных действий имеют свои сложности. Альтернативой станет скачивание профиля, который определяет
расширение (по указанной ссылке), поиск обозначенного расширения и затем использование имени соответствующего
расширения для отображения его пользователю. Сообщение об ошибке может выглядеть следующим образом:
<!--When an application that doesn't understand this extension tries to process this resource, it is required to either 
refuse to process the resource (or containing element), or provide an appropriate warning to its users. Either of these 
courses of action is potentially difficult. One option is to download the profile that defines the extension (from the 
given URL), find the name of the extension, and then use the name to display the extension to the user. An error message 
could look something like this: -->

</p>
<img src="modifier-extension-warning.png"/>
<p>
Обратите внимание: описательная (человекочитаемая) часть ресурса (narrative) должна содержать уточняющие данные,
отраженные в элементах-расширениях, изменяющих значение родительского элемента, so it is safe to show this to 
the user as an expression of the resource's content. В окне предупреждения пользователю будет предложено просмотреть 
оригинальный текст описательной части ресурса (narrative). 
<!--Note that the narrative of the resource SHALL contain this qualifying information, so it is safe to show this to 
the user as an expression of the resource's content. A warning dialog box could be extended to offer the user the choice 
to see the original narrative. -->
</p>
<div class="example">
<p>
Приведем пример записи (statement) о том, что конкретный врач-хирург не выполнил операцию:
</p>
<pre class="xml">
&lt;Procedure xmlns=&quot;http://hl7.org/fhir&quot;&gt;
  &lt;text&gt;
    &lt;status value=&quot;generated&quot;/&gt;
    &lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;Routine appendicectomy for Fred Smith performed By Susan Taylor. Note: This operation was not performed by Dr Lakin&lt;/div&gt;
  &lt;/text&gt;
  &lt;!-- ...data... --&gt;
  &lt;performer&gt;
    &lt;modifierExtension&gt;
      &lt;url value=&quot;http://example.org/fhir/extensions#didNotPerform&quot;/&gt;
      &lt;valueBoolean value=&quot;true&quot;/&gt;
    &lt;/modifierExtension&gt;
    &lt;person&gt;
      &lt;reference value=&quot;Practitioner/example&quot;/&gt;
      &lt;display value=&quot;Dr Lakin&quot;/&gt;
    &lt;/person&gt;
  &lt;/performer&gt;
  &lt;!-- ...data... --&gt;
&lt;/Procedure&gt;
</pre>
</div>
<p>
Если приложение не распознает исполнителя действия (performer) (описанного в примере), факт того, что расширение 
"modifierExtension" уточняет элемент "performer" неважен - разрешается игнорирование расширения. 
</p>

<h3>Особые случаи: отсутствуют данные</h3>
<p>
В некоторых случаях разработчики могут обнаружить, что данные для обязательного элемента 
(... do not have appropriate data for an element with minimum cardinality = 1 ...) отсутствуют.  
В таком случае, элемент должен быть обязательно включен в структуру ресурса, но, пока ресурс или соответствующий ему 
интеграционный профиль не потребует наличия реального значения (соответствующего простым типам данных), такой элемент
может иметь элемент-расширение, объясняющее, почему реальное значение отсутствует. 
<!--In some cases, implementers may find that they do not have appropriate data for an
element with minimum cardinality = 1. In this case, the element must be present, but 
unless the resource or a profile on it has made the actual value of the primitive 
data type mandatory, it is possible to provide an extension that explains why the 
primitive value is not present: -->
</p>
<pre class="xml">
&lt;uri&gt;
  &lt;extension url=&quot;http://hl7.org/fhir/Profile/general-extensions#data-absent-reason&quot;&gt;
    &lt;valueCode=&quot;unknown&quot;/&gt;
  &lt;/extension&gt;
&lt;/uri&gt;
</pre>
<p>
В данном примере, вместо значения (value) указывается <a href="general-extensions.html">код отсутствия данных (data missing code)</a>. 
Обратите внимание, что использование расширения такого типа необязательно. Данный элемент-расширение <b>нельзя</b> считать модификатором
(modifier extension), т. к. ему не присваиваются значения, соответствующие примитивным типам данных. 
<!--In this example, instead of a value, a data missing code is provided. Note that it is not required that this particular 
extension be used. This extension is not a modifier extension, because the primitive data type has no value.-->  
</p>
<p>
Неправильно создавать формальное наполнение элемента (fictional piece of data) с содержимым соответствующим
примитивным типам данных, а затем включать в элемент расширение, определяющее добавление данных в целях обеспечения 
соответствия. Данное решение было бы неправильным еще и потому, что недопустимо использовать элемент "modifierExtension" 
для уточнения типов данных.
<!-- It is not valid to create a fictional piece of data for the primitive value,
and then to add an extension indicating that the data has been constructed
to meet the data rules. This would be both a bad idea, and also a modifier
extension, which is not allowed on data types. -->
</p>


<a name="exchange"> </a>
<h2>Обмен расширениями</h2>

<p>Элементы-расширения позволяют отражать локальные потребности здравоохранения с помощью подхода,
основанного на универсальной [модели] информации. Это необходимо, чтобы медицинские системы могли
работать с ресурсами с помощью одинаковых средств и инструментов. Однако, когда речь идет об обработке информации 
(содержищейся в ресурсах и уточненной расширениями), приложения будут ограничены в обработке расширений в той степени, 
в которой они располагают данными о них.
<!-- Extensions are a way of allowing local requirements to be reflected in a resource using
a common information based approach so that all systems can confidently process them 
using the same tools. However, when it comes to processing the information, applications
will be constrained in their ability to handle extensions by the degree to which they 
are informed about them. -->
</p>
<p>
Несмотря на то, что каждое выражение (expression) должно сопровождаться описанием его структуры (structure definition) 
(см. далее подробности), само по себе наличие описания не означает, что приложение, понимает как правильно
обрабатывать расширение. В целом, всегда требуется решение человека, который определит, каким образом будут 
использоваться данные, содержащиеся в элементах-расширениях, и какие обязательства в отношении данной информации должны 
выполняться.
<!-- While the structured definition of an extension should always be available (see below for 
details), the mere availability of a definition does not automatically mean that applications
know how to handle them correctly - generally, human decisions are required to made around
how the data extensions contain should be handled, along with the implicit obligations 
that around the information. -->
</p>
<p>
По этой причине, локальные потребности, которые находят отражение в форме расширений, препятствуют интеграции.
Чем больше требований являются универсальными (например на региональном или общегосударственном уровне), тем меньшее
влияние они оказывают на процессы интеграции. Согласованное представление, определение и регистрация расширений, 
описанных в данной спецификации, не поможет решить существующую проблему. Необходима методология, которая упростит 
работу с локальными вариантами ресурсов.
<!-- For this reason, local requirements that manifest as extensions are an obstacle to 
integration. The more the requirements are shared (i.e. regional or national scale),
the less impact they will have. The consistent representation, definition and registration of 
extensions that this specification defines cannot resolve that problem - it only provides a framework 
within which such local variations can be handled more easily.  -->
</p>
<p>
Внедрение медицинских приложений, обеспечивающих поддержку локальных потребностей, часто сопровождается ситуацией,
при которой обменивающиеся информацией приложения поддерживают разные наборы расширений. Спецификация FHIR
устанавливает ряд простых правил, направленных на управления такими ситуациями, однако не способна предложить решения
для такого рода несоответствий.
<!-- When it comes to deploying applications that support local requirements, situations will very likely arise where 
different applications exchanging information with each other are supporting different sets of extensions. This 
specification makes some basic rules that are intended to make management of these situations easier, but they cannot 
resolve them. -->
</p>
<ul>
 <li>При обмене ресурсами, системы МОГУТ, по возможности, сохранять неизвестные расширения (также как и базовые элементы ресурса) </li>
 <li>Если система изменяет ресурс, она МОЖЕТ удалить любые расширения, семантика которых для нее непонятна. Необходимо
 удалять элемент-модификатор и все его элементы-потомки, потому что изменения, вносимые в ресурс могут сделать
 элемент-расширение некорректным</li>
<!--If a system modifies a resource it SHOULD remove any extensions that it does not understand from the modified element
and its descendants, because it cannot know whether the modifications it has made might invalidate the value of 
the unknown extension --> 
 <li>Системы, удаляющие (drop) существующие элементы, занимаются "обрабаткой ресурса" ("processing the resource")</li>
 <li>Система НЕ ДОЛЖНА изменять ресурсы или элементы, которые содержат элементы-модификаторы с неясной семантикой  
 <!--A system SHALL not modify a resource or element that contains "modifier" extensions it doesn't understand --></li>
 <li>Приложения МОГУТ игнорировать расширения с неясной семантикой, если эти расширения не изменяют значение
 родительского элемента
 <!--Applications SHOULD ignore extensions that they do not recognize if they are not "modifier" extensions --></li>
 <li>Системы, которые не принимают (к обработке) неизвестные расширения ДОЛЖНЫ указывать это в экземплярах ресурсов,
 обеспечивающих соответствие (Conformance resource instance)
 <!--Systems that do not accept unknown extensions SHALL declare so in their Conformance resource instances --></li>
</ul>
<p>
То, в какой степени приложения должны сохранять неизвестные элементы-расширения зависит от функциий, которые они 
выполняют: FHIR-сервер общего назначения или промежуточная платформа (middleware engine) сохраняют все расширения, в то 
время, как приложения, используемые для управления данными пациентов (последством пользовательского интерфейса) 
при регистрации, сохраняют только те, из неизвестных расширений, которые входят в набор информации, 
непосредственно обрабатываемой пользователем.
<!--The degree to which a system can retain unknown extensions is a function of the type of system
it is: a general purpose FHIR server, or a middleware engine would be expected to retain 
all extensions, while an application that manages patient registration through a user 
interface can only retain extensions to the degree that the information in them is part of the
set managed by the user. Other applications will fall somewhere between these two extremes. -->
</p>

<h3>Summary: Handling extensions</h3>
<p>
Use the following rules as a guideline for handling resources:
</p>
<ul>
 <li>При написании расширений, убедитель что они имеют [формализованное] описание и находятся в открытом доступе
 <!-- When writing extensions, make sure they are defined and published --> </li>
 <li>When reading, navigating through or searching on elements that can have modifier extensions, check whether there are any</li>
 <li>При чтении элементов, игнорируйте другие элементы-расширения, только если не хотите прочитать конкретное расширение
 <!--Вы When reading elements, ignore other extensions, unless you want to read a particular extension--></li>
 <li>Старайтесь сохранять расширения, если это возможно<!--Retain extensions whenever you can--></li>
</ul> 
 
<a name="define"></a>
<h2>Определение элементов-расширений (Defining Extensions)</h2>

<p>
Определение расширений может выполняться в рамках любого проекта, любой страной или территорией и, в том числе, 
международными организациями по разработке стандартов (включая HL7).
<!--Extensions may be defined by any project or jurisdiction, 
up to and including international standards organizations such as HL7 itself. -->  
Расширения определяются и публикуются в составе <a href="profile.html">профиля ресурса (Resource Profile)</a>. 
<!--Extensions are defined and published as part of a <a href="profile.html">Resource Profile</a>.-->
Определение элементов-расширений всегда происходит в соответствии с конкретным контекстом - т.е. типом элемента,
значение которого уточняется. <!--Extensions are always defined against some particular context - the type of element 
hat they may be used to extend. -->
Ниже представлены возможные контексты для расширения:
<!-- The following are possible contexts for an extension: -->
</p>
<table class="codes">
 <tr><th>Тип контекста (Context type)</th><th>Формат контектса (Context format)</th><th>Примеры (Examples)</th></tr>
 <tr><td>Конкретный элемент (включая корневой) ресурса <!--A particular element (including the root) in a single resource --></td><td>Путь конкретного элемента <!--The element path for that element --></td><td>Profile.resource.element; Person</td></tr>
 <tr><td>Конкретный элемент (включая корневой) в конкретном типе данных <!--A particular element (including the root) in a particular data type --></td><td>Имя примитивного типа данных или путь элемента для комплексного типа данных <!--The data type name for primitive types or the element path for complex data types --></td><td>Address.part.value; string</td></tr>
 <tr><td>Конкретный контекст в одной из "привязанной" эталонных моделей<!--A particular context in one of the mapped reference models --></td><td> Имя эталонной модели и путь мэппинга (mapping path)<!-- The name of the reference model followed by the mapping path --></td><td>RIM: Act[moodCode="EVN"]</td></tr>
 <tr><td>Другое расширение (Another extension)</td><td>URI профиля, применяемого к расширению, и кодовое обозначение расширения (extension code)</td><td>http://myextensions.org#someExtension</td></tr>
 <tr><td>Комбинации вышеуказанных контектсов</td><td>Как в вышеуказанном примере, разделяется с помощью ';'</td><td>Address; Contact</td></tr>
</table>
<p>
Кроме того, на определение расширения могут накладываться дополнительные ограничения в соответствии с конкретными
значениями элементов уточняемого родительского элементов. Дополнительные ограничения обеспечивают корректность 
опредления. Расширения ДОЛЖНЫ применяться только к тем элементам, для которых они определены.
<!-- In addition, an extension definition might apply additional constraints with
regards to particular element values of the target that make its use appropriate.
Extensions SHALL only be used on a target for which they are defined. -->
</p>
<p>
Определение расширений происходит с помощью следующих полей:
<!-- Each extension is defined using the following fields: -->
</p>
<table class="codes">
 <tr><td>Поле</td><td>Обязательный</td><td>Путь в профиле (Path in Profile) (в Profile.extensionDefn)</td><td>Описание</td></tr>
 <tr><td>Код (Code)</td><td>Да</td><td>.code</td><td> Имя, используемое как идентификатор расширения в ресурсе - уникальное в контексте определяющего профиля <!--The name that is used as a code in a resource to identify this extension - unique in the context of the defining profile --></td></tr>
 <tr><td>Контекст (Context)</td><td>Да</td><td>.contextType и .context</td><td> Контекст расширения. См. выше. Контекст имеет две составляющих - тип (type) и путь (path), по которому можно получить подробные данные <!-- The context of this extension. See above. The context has two parts:  a type, and a path which supplies the details --></td></tr>
 <tr><td>Краткое определение (Short Definition)</td><td>Да</td><td>.definition.short</td><td> Краткое описание расширения, используемое в XML-описаниях, когда на расширение указывается ссылка в профиле <!--A brief description of the extension used in the XML descriptions when the extension is referenced in a profile --></td></tr>
 <tr><td>Определение (Definition)</td><td>Да</td><td>.definition.formal</td><td>Формальное заявление о значении содержимого поля <!-- A formal statement of the meaning of the content of the field --></td></tr>
 <tr><td>Требования (Requirements)</td><td>Нет</td><td>.definition.requirements</td><td>Определяет причину, по которой требуется использование расширения <!-- Identifies the reason the extension is needed --></td></tr>
 <tr><td>Комментарии (Comments)</td><td>Нет</td><td>.definition.comments</td><td> Другая дополнительная информация о элементе-расширении (включая заметки по использованию расширения) <!--Additional other information about the extension, including information such as use notes --></td></tr>
 <tr><td>Мощность множества объектов (Cardinality)</td><td>Да</td><td>.definition.min / .definition.max</td><td>Мощность множества объектов расширения. <!-- The cardinality of this extension. --><br/> Specifying a minimum cardinality of 1 means that if the source system declares that it conforms to an extension that declares a type including this extension, this extension must be included in the resource.  Cardinality can be constrained but not loosened in profiles that reference this extension</td></tr>
 <tr><td>Тип (Type)</td><td>Да</td><td>.definition.type</td><td>Тип(ы) расширения. Должен соответствовать корректному типу данных FHIR, как описано выше, или отсутствовать (empty), если элемент-расширение содержит в себе другие расширения. <!--The type(s) of the extension. This SHALL be a valid FHIR data type as described above, or empty, if the extension will contain other extensions --></td></tr>
 <tr><td>XPaths</td><td>Нет</td><td>.definition.constraint</td><td>Одно или несколько заявлений XPath должно являться истинным (evaluate to true), если используется расширение <!--One or more XPath statements that SHALL evaluate to true when the extension is used --></td></tr>
 <tr><td>Модификатор IS (Is Modifier)</td><td>Да</td><td>.definition.isModifier</td><td>  Если расширение меняет значение или интерпретацию элемента, содержащего расширение (или любого потомка такого элемента). Расширение, определяемые "IsModifier=true" всегда представляются элементами <i>modifierExtension</i>, а расширения, определяемые "IsModifier=false" всегда представлены элементами <i>Extension</i> <!-- Whether the extension changes the meaning or interpretation of the element containing the extension (or any descendant  of that element). Extensions defined as IsModifier=true are always represented in <i>modifierExtension</i> elements,  and extensions defined as IsModifier=false are always represented in <i>Extension</i> elements --></td></tr>
 <tr><td>Мэппинг RIM (RIM Mapping)</td><td>Может быть обязательным</td><td>.definition.mapping...</td><td>Формальная привязка (mapping) расширения к Эталонной информационной модели (RIM). Необходимо для HL7-определенных расширений, которые применяются к ресурсам, привязанным к RIM, но необязательным в иных контектсах <!--The formal mapping from this extension to the RIM. Required for HL7-defined extensions that apply to resources with RIM mappings, but optional in other contexts --></td></tr>
 <tr><td>Мэппинг v2</td><td>Нет</td><td>.definition.mapping...</td><td> Мэппинг с сегментом / полем / и т. д. HL7 v2. Необязательно, но может указываться <!--Mapping to a v2 segment/field/etc., if desired and appropriate. --></td></tr>
 <tr><td>Привязка (Binding)</td><td>Может быть обязательным</td><td>.definition.binding</td><td>Используется для типов CodeableConcept и Coding См. <a href="terminologies.html">Справочники</a> <!--For the types CodeableConcept and Coding. See <a href="terminologies.html">Terminologies --></td></tr>
</table>
<p>
Замечания:
</p>
<ul>
 <li>Мэппинги не обязательно должны быть машиннообрабатываемыми (т.е. с исполняемой логикой). <!-- Mappings are not required to be computable (i.e. executable logic). -->
 Могут указываться привязки к другим спецификациям <!--Mappings to other specifications can also be provided. --></li>
</ul>
<p>
При обмене содержащими расширения ресурсами, определения расширений ДОЛЖНЫ быть доступны для всех сторон, 
участвующих в совместном использовании ресурсов. Всем расширениям присвоен URI, который ссылается на источник
формализованного описания - профиль ресурса. Источник (определения) ДОЛЖЕН представлять собой буквальную ссылку (напр., http:url),
которая ссылается на конечную точку, содержащую определения, желательно, <a href="http.html">FHIR RESTful сервер</a>,
поддерживающий профиль ресурса или логическую ссылку (с помошью urn:) - например, на опубликованный национальный стандарт.
<!-- Whenever resources containing extensions are exchanged, the definitions of the extensions SHALL be available to all the 
parties that share the resources. Each extension contains a URI that references the source of the definitions as a 
Resource Profile. The source SHOULD be a literal reference, such as an http: url that refers to an end-point that 
responds with the contents of the definitions - preferably a <a href="http.html">FHIR RESTful server</a>
supporting the Resources Profile, or a logical reference (e.g. using a urn:) - for instance, to a national published
standard. -->
</p>
<a name="definition"> </a>
<h2>Управление расширениями (Control of extensions)</h2>
<p>
Помимо определения базовой структуры элементов ресурса, организация HL7 International также публикует расширения.
HL7 International публикует определения данных (data definition) как расширения, а не как часть базовой структуры ресурса
для того, чтобы сохранить базовую структуру ресурса простой и компактной, а также освободить разработчиков от излишней
функциональности. Обратите внимание, что HL7 не дает определение элементам-расширениям, уточняющим значение родительского 
ресурса (modifier extension) - если организация HL7 International публикует элемент, который изменяет значение
(modifies the meaning) других элементов, он будет включен в содержимое ресурса, т. к. понимание семантики такого 
расширения - обязательное требование для всех.
<!-- As well as defining the base element structure for resources, HL7 also publishes extensions. 
HL7 publishes data definitions
as extensions rather than as part of the base resource structure in order to keep the base
resource structure simple and concise, and to allow implementers not to engage with an entire world's
worth of functionality up front. Note that HL7 does not define "modifier" extensions - if
HL7 publishes an element that modifies the meaning of other elements, it will be part of the resource
content itself, since everyone has to understand the extension anyway. -->
</p>
<p>
Перед тем, как расширения можно будет использовать в экземплярах элементов и ресурсов, они ДОЛЖНЫ быть опубликованы.
Организация HL7 International обеспечивает поддержку двух реестров расширений (extension registry); пользователи 
поощряются регистрировать свои расширения в этих реестрах. Однако, это совсем не обязательно. 
Все, что требуется - опубликовать расширение в контексте (context), доступном для других пользователей расширения.
Например, если конкретное расширение используется в рамках одного медучреждения, определение расширения (extension
definition) может быть размещено в интрасети этого учреждения. Но, учитывая то, что обмен ресурсами достаточно
распространен (из-за самой природы ресурсов), советуется использовать реестры организации HL7 International или любой 
другой общедоступный реестр элементов-расширений.
<!-- Before extensions can be used in instances, they SHALL be published. HL7 maintains two
extension registries and users are encouraged to register their extensions there. But
this is not required. All that is required is that the extension is published in a
context that is available for users of the extension. So, for example, if a particular
extension is used within a single institution, the definition of the extension
can be placed on the institution's intranet. However since, by their nature, resources
tend to travel well, it's always better to use the HL7 or other publicly accessible extension registries. -->
</p>
<p>
Организация HL7 International предлагает два реестра элементов-расширений, первый из которых предназначен для
расширений, одобренных HL7. Данный репозиторий одобрен соответствующей частью сообщества HL7 International по итогам 
процесса рассмотрения (пересмотра) и может считаться официальным репозиторием расширений. Второй реестр является
служебным репозиторием сообщества HL7 - каждый желающий может зарегистрировать там свой элемент-расширение.
<!-- HL7 provides two extension registries. The first is for HL7 approved extensions. These
have been approved by an appropriate part of the HL7 community following a review process,
and have formal standing. The other registry is provided as a service to the community,
and anyone can register an extension on it. -->
</p>
<table class="codes">
 <tr><th>Реестр (Registry)</th><th>Поиск (Search)</th><th>Загрузка расширения (Submit)</th></tr>
 <tr><td>Одобренный HL7 (HL7 Approved)</td><td>[TBD]</td><td>[TBD]</td></tr>
 <tr><td>Community</td><td>[TBD]</td><td>[TBD]</td></tr>
 <tr><td>Interim</td><td><a href="http://hl7connect.healthintersections.com.au/svc/fhir/profile/search">http://hl7connect.healthintersections.com.au/svc/fhir/profile/search</a></td>
 <td><a href="http://hl7connect.healthintersections.com.au/svc/fhir/profile/upload">http://hl7connect.healthintersections.com.au/svc/fhir/profile/upload</a></td></tr>
</table>
<p>
Профили от HL7, определяющие расширения, приобретают статус официальных профилей голосованием членов сообщества HL7, 
также как и содержимое ресурса в составе спецификации FHIR или могут быть опубликованы в составе других спецификаций. 
<!-- HL7 profiles defining extensions may be balloted alongside resource content as part of the FHIR specification or may
be published as part of separate specifications. -->
Когда организация HL7 International публикует расширения в составе спецификации FHIR, 
такие расширения ДОЛЖНЫ использоваться, когда данные, уточняемые этим расширением, встречаются в экземплярах 
ресурсов и элементов. <!--When HL7  publishes extensions as part of the FHIR specification, these extensions SHALL
be used for this data whenever the data is represented in instances. -->
Приложения ДОЛЖНЫ использовать элементы-расширения, определенные организацией HL7 International, для представления
данных, эквивалентных используемым данным, в целях обеспечения интероперабельности.
<!--Applications SHOULD use other HL7-defined extensions published to represent equivalent data in the interest of maximum 
interoperability. -->
Если при указании ссылки на профиль, определяющий расширение, приложение / система заявляет о соответствии с
профилем, то она ДОЛЖНА использовать заимствованные и определенные профилем элементы-расширения, передающие аналогичные
элементы данных.
<!-- If referencing a profile that defines extensions, implementations declaring conformance with the profile SHALL
use the profile-defined and imported extensions when conveying equivalent data elements. --> 
</p>
<p>
Для минимизации сложности реализации, организация HL7 International не будет включать содержимое (определенное в
одобренных ею расширениях) в базовую структуру ресурса в будущих версиях стандарта FHIR, если ресурс уже получил
статус нормативного (normative).
<!-- To minimize complexity for implementers, HL7 will not elevate content defined in an HL7-approved extension to
be content defined in a core resource in future versions of the resource once that resource is normative. -->
</p>
<p>
В некоторых случаях, рабочая группа HL7 или любой другой орган имеет право опубликовать профиль, основной целью которого 
является определение расширений, которые, как ожидается, понадобятся разработчикам в определенных обстоятельствах (in a
particular context). Например, расширения, необходимые для привязки (mapping) конкретного набора сегметов HL7 v2 или
модели HL7 v3. <!-- In some cases, an HL7 work group or other body may publish a profile whose sole purpose 
is to define extensions expected to be needed by implementers in a particular context.  E.g. extensions needed to 
map a particular set of v2 segments or a v3 model. -->
</p>
<p>
Разработчики поощряются делиться расширениями с организацией HL7 и регистрировать их в реестре HL7.
Комитеты организации, ответственные за отдельные домены здравоохранения проведут работу по публикации предложенных 
расширений или, если предложенные расширения будут приняты к использованию существенной частью сообщества разработчиков,
они могут быть внесены в базовую структуру ресурса.
<!-- Implementations are encouraged to share their extensions with HL7 and register them with the HL7 extension registry. 
The domain committees will work to elevate the extensions into HL7 published extensions or, if adopted by a broad 
enough portion of the implementer community, the into the base resource structure itself. -->
</p>
<!-- Todo: point to actual registry once it's up and running -->
<p>Для того, чтобы избежать проблем с интероперабельностью, определение расширений НЕ ДОЛЖНО меняться после того, как
они были опубликованы. (Разрешается вносить уточнения в описание, если они не влияют на интероперабельность.) Вместо того,
чтобы изменять существующее расширение, необходимо использовать новый элемент-расширение. В ходе пересмотра расширений, 
набор контекстов их использования может быть расширен, однако, предыдущие контексты использования расширений не могут
быть исключены или ограничены.
<!--To avoid interoperability issues, extensions SHALL NOT change their definition once published.  
(Small clarifications to descriptions that do not affect interoperability are permitted.)  
Rather than modifying an existing extension, a new extension should be introduced.
Revisions to an extension may extend the set of contexts in which the extension apply but may not remove or constrain 
any context previously listed --> </p>
<!-- Todo: Figure out how to manage "deprecating" extensions and pointing at their new versions -->

</div>
[%onthispage Extensibility#root|isModifier#isModifier|Defining Extensions#definition%]

[%file newfooter%]
</body>
</html>
