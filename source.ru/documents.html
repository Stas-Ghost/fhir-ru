<!DOCTYPE HTML>


<!--
Outstanding issues:
- relationships 
- representation

-->
     
[%settitle FHIR-документы%]
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
[%file newheader%]
</head>
<body>
[%file newnavbar%]

<div class="col-9">

<h1>FHIR-документы</h1>

<p>
FHIR-ресурсы могут быть использованы для построения документов, которые представляют композицию: набор согласованной информации, которая является утверждением информации о здравоохранении, в частности включая клинические обследования и службы. 

Документ - это иммутабельный набор ресурсов с фиксированным представлением, который создан и/или заверен людьми, организациями и устройствами. 

Документами, построенными таким способом, можно обмениваться между системами и также сохранять в хранилище документов и системах управления, включая такие системы, как IHE XDS. 

Приложения, заявляющие о соответствии этому фреймворку, заявляют о соответствии "FHIR-документам". 

FHIR-документы могут быть 'клиническими' (направленными на медицинскую информацию о пациенте), а также могут служить не клиническим целям (например практические руководства, наглядные материалы для пациентов и т. п.). HL7 будет разрабатывать профили в будущем, давая дополнительное руководство по подходящему представлению клинических документов как в общем, так и в частных случаях клинических документов (например Consolidated CDA).
</p>

<p>
Обратите внимание, что FHIR устанавливает и формат этого документа, и <a href="documentreference.html">ресурс ссылки на документы (document reference resource)</a>. 
FHIR-документы - для документов, которые созданы и собраны в FHIR, а ресурс ссылки на документы - для общих ссылок на другие документы. 
</p>

<h2>Содержимое документа</h2>

<p>
Все документы имеют одинаковую структуру: <a href="extras.html#bundle">комплект</a> 
<a href="extras.html#tags">ресурсов, обозначенный тегом</a> "http://hl7.org/fhir/tag/document", который имеет ресурс <a href="composition.html">Composition</a> первым ресурсом в комплекте, за которым следует серия других ресурсов, на которые имеются ссылки из ресурса <i>Composition</i> 
, который содержит правила, по которым они согласовываются между собой. Комплект собирает все содержимое документа в единый XML-документ, который может быть подписан и администрироваться как требуется. Ресурсы включают в себя и человекочитаемые, и обрабатываемые компьютером блоки. Кроме того, комплект может включать в себя <a href="http://www.w3.org/Style/CSS/Overview.en.html">каскадные таблицы стилей</a>, заявления о 
<a href="provenance.html">происхождении (provenance statements)</a> и подпись.
</p>
<p>
Ресурс Composition является основой клинического документа. Он:
</p>
<ul>
 <li>содержит именование и назначение, устанавливает контекст документа;</li>
 <li>несет ключевую информацию, такую как объект и автор, и кто утвердил документ;</li>
 <li>делит документ на серию разделов, которые содержат другие ресурсы, обозначенные в этой спецификации, которые несут содержимое.</li>
</ul> 
<p>
Любой ресурс, на который есть прямая ссылка из Composition, ДОЛЖЕН быть включен в комплект во время сборки документа. Другие ресурсы, на которые ссылаются эти ресурсы, могут также быть включены в комплект, если такое решение примет система построения документа. Включение этих дополнительных ресурсов сделает документ больше, однако убережет приложения от необходимости получения связанных ресурсов, если они понадобятся им во время обработки документа. Таким образом решение о том, должны связанные ресурсы быть включены или нет, зависит от среды реализации. 
</p>
<p>
Комплект документов НЕ ДОЛЖЕН включать ни один из ресурсов из этого списка:
</p>
<ol>
 <li>Ресурс Composition и любые ресурсы, на которые есть прямая или косвенная (т. е. рекурсивная) ссылка из него.</li>
 <li>Ресурс Binary, содержащий таблицу стилей (как описано выше).</li>
 <li>Provenance-ресурсы, у которых есть цель, которая является ресурсом, включенным в пункт №1.</li>
</ol>
<p>
У документа имеется два ключевых идентификатора:
</p>
<ul>
 <li>Идентификатор документа (обязательный). Он находится в <i>feed.id</i> и является уникальным для этого экземпляра документа и никогда не используется повторно. </li>
 <li>Структурный идентификатор (необязательный). Он находится в <i>Composition.identifier</i>и является одинаковым для всех документов, содержащихся в композиции. </li> 
</ul>

<p>
В документе указывается несколько дат:
</p>
<ul>
 <li>Дата документа (обязательно). Она находится в <i>feed.updated</i> и указывает, когда комплект документа был собран из лежащих в его основе ресурсов.</li>
 <li>Дата композиции (обязательно). Находится в <i>Composition.instant</i>, это дата, когда автор написал документ логически.</li> 
 <li>Даты утверждения (необязательно). Находится в <i>Composition.attester.time</i> , это дата, когда документ был засвидетельствован очевидцами. Обычно это будет то же самое время, что и дата композиции, либо позднее.</li> 
 <li>Дата последнего изменения композиции (обязательно согласно Atom). Находится в <i>entry.updated</i> для композиции, и это дата последнего изменения композиции. Она должна быть &gt;= дате композиции.</li> 
</ul>
<p>
Комплекты документов могут быть подписаны электронными цифровыми подписями в соответствии с правилами <a href="http://tools.ietf.org/html/rfc4287" target="_blank">спецификации Atom</a>. 
Подпись ДОЛЖНА быть поставлена очевидцем из списка в документе и подпись ДОЛЖНА содержать элемент <a href="http://www.w3.org/TR/xmldsig-core/#sec-KeyInfo" target="_blank">KeyInfo</a>, содержащий элемент KeyName, значением которого является URI, совпадающий с Atom-элементом <i>link</i> для соответствующего attester-ресурса.
</p>
<p>
Однажды собранный в комплект, документ становится иммутабельным - его содержимое больше не может быть изменено, а id документа не может быть повторно использован. Обратите внимание, что документ может быть представлен в XML либо JSON-формате, конвертироваться между ними или менять кодировку символов, и при этом оставаться тем же самым документом. Однако содержимое (набор утвержденных ресурсов и их порядок) и представление документа не могут быть изменены. Все дополнительные документы, вытекающие из одной композиции, ДОЛЖНЫ иметь различные идентификаторы документа. 
</p>

<a name="presentation"> </a> 
<h3>Представление документа</h3>
<p>
Когда документ представляют человеку, приложения должны показать объединенные описательные части следующих ресурсов в таком порядке:
</p>
<ol>
 <li>Ресурс Composition </li>
 <li>Ресурс Subject </li>
 <li>Ресурсы, на которые имеются ссылки в <i>section.content</i></li>
</ol>
<p>
Описательная часть ресурса Composition должна суммировать важные части заголовка документа, которые требуются для установления клинического контекста документа (отличного от субъекта, который отображается сам по себе (in its own right). Фактически чтобы построить скомбинированную описательную часть, просто склейте все описательные &lt;div&gt;-фрагменты вместе. 
</p>
<p>
Утвержденным содержимым документа является композиция, субъект и ресурсы, на которые имеются ссылки в этих секциях. В комплект могут быть включены дополнительные ресурсы, однако они не являются заверенным содержимым. Более точно, свидетель заверяет представленную форму документа.
</p>
<p>
<a href="downloads.html#refimpl">XML Tools reference implementation</a> включает в себя преобразование для конвертации документа в XHTML, готовый для показа в браузере.
</p>


<a name="css"></a>
<p>
В дополнение к <a href="narrative.html#css">базовым правилам оформления описательной части</a>, которые должны соблюдаться, документ может ссылаться или содержать один или больше таблиц стилей, включающих дополнительные стили, применяемые к объединенным описательным частям. Это достигается объявлением ссылок на таблицы стилей в фиде:
</p>
<pre class="xml">
&lt;feed xmlns=&quot;http://www.w3.org/2005/Atom&quot;&gt;  
  &lt;title&gt;FHIR Document&lt;/title&gt;
  &lt;id&gt;urn:uuid:e1db84d2-a524-40a3-827b-076a277ef7df&lt;/id&gt;
  &lt;link rel=&quot;stylesheet&quot; href=&quot;[uri]&quot;/&gt;
</pre>
<p>
Этот URI может быть абсолютной ссылкой на каскадную таблицу стилей или относительной ссылкой на бинарный ресурс, содержащий CSS-таблицу. Ссылки на таблицы стилей могут ссылаться только на CSS - другие формы таблиц стилей не допустимы.
</p>
<p>
Относительные (внутренние) ссылки ДОЛЖНЫ использоваться, если документ не безопасно просматривать без применения указанной таблицы стилей, т. к. другой адрес может быть не доступен просмотрщику из-за технических проблем или решений политики безопасности [policy decisions].
</p>
<p>
Если другое не указано в локальных торговых партнерских соглашениях, приложения, отображающие объединенную описательную часть, ДОЛЖНЫ использовать таблицы стилей, указанные в документе. Сторонам, входящие в торговое соглашение, поступающим иначе, следует очень тщательно рассмотреть последствия, которые  это действие будет иметь на их долгосрочную область действия обмена документом. Если стороны согласны использовать таблицы стилей, не содержащиеся в документе, тогда, возможно, они никогда не смогут совместно использовать свои документы безопасно в более широком контексте, таком как региональные или национальные EHR или глобальные персональные медицинские документы. 
</p>


<h2>Профили документов</h2>

<p>
<a href="profile.html">Профили документов</a> используются для описания документов конкретного назначения. Профили документов могут вводить правила о:
</p>
<ul>
 <li>Содержимом ресурса Composition, в том числе</li>
 <li>Структуре разделов в композиции</li>
 <li>Какие ресурсы должны быть включены в комплект наряду с ресурсами, на которые есть прямые ссылки в ресурсе Document</li>
</ul> 
<p>
Приложениям следует рассмотреть публикацию <a href="conformance.html">заявлений о соответствии</a>, в которых указываются конкретные документы, которые они поддерживают. Документы могут указывать профиль, которому они соответствуют, с помощью размещения тега профиля в элементе <i>feed.category</i> - см. <a href="extras.html#profile-tags">Теги профилей [Profile Tags]</a> для обсуждения их использования.
</p>


<h2>Обязательства при обработке документов</h2>
<p>
Авторы/конструкторы и обработчики Клинических документов - люди или программное обеспечение - имеют обязательства, которым они должны соответствовать.
</p>

<h3>Обязательства автора/конструктора</h3>
<p>
Конструктор документа - это приложение, которое создает документ. Автор - это человек, организация или устройство, использующее конструктор для создания документа. Между собой, конструктор и автор могут создавать новые контент-ресурсы и/или делать сборки из уже существующих контент-ресурсов при выполнении своих задач. Также у них есть следующие обязанности:
</p>
<ul>
 <li>Гарантировать, что документ ДОЛЖЕН содержать допустимую композицию, которая соответствует правилам, описанным здесь, и ссылается только на другие допустимые ресурсы.</li>
 <li>Гарантировать, что содержимое документа ДОЛЖНО соответствовать всем объявленным <a href="profile.html">Профилям</a> (см. ниже).</li>
 <li>Ручаться, что свидетели должным образом ознакомлены с представлением документа, который они заверяют.</li>
</ul>

<h3>Обязательства обработчика</h3>
<p>
Обработчик документа - это приложение и/или человек-пользователь, который получает документы и извлекает данных из них или принимает решения на их основе. Эти документы могут быть получены прямо из конструктора документов, доступного через систему управления документами или переадресованного третьей стороной. Обработчик документов обеспечивает гарантию того, что полученные документы обработаны и/или отображены в соответствии с данной спецификацией. Обработчик документов обязан гарантировать соблюдение следующих правил:
</p>
<ul>
 <li>При сохранении/передаче документа любой метод может быть использован, пока документ комплекта может быть (пере)собран с достаточной целостностью для подтверждения достоверности цифровой подписи. </li>
 <li>При представлении описательной части документа ДОЛЖНЫ быть соблюдены правила, описанные выше.</li>
 <li>Ресурсы или данные из документа могут быть извлечены в дополнительных целях, однако такие данных больше не рассматриваются как заверенные автором документа.</li>
 <li>Показываются ли данные из документа пользователю, ДОЛЖЕН всегда быть способ для пользователей получить доступ к представлению оригинального документа.</li>

</ul>
<p>
В дополнение к этим обязательствам, получатели документа СЛЕДУЕТ тщательно отслеживать источник документов за новыми документами, которые могут заменять существующие документы, в частности когда документы представляют композиции, которые были сокращены. Когда документы заменяются, они ДОЛЖНЫ либо отозвать данные, извлеченные из замененных документов, либо предупреждать пользователей при просмотре документа или данных, взятых из него.
</p>

<a name="signatures"> </a>
<h2>Подписание документов</h2>
<p>
Документы могут иметь либо <a href="http://www.w3.org/TR/xmldsig-core/#def-SignatureEnveloped">enveloped</a>, либо <a href="http://www.w3.org/TR/xmldsig-core/#def-SignatureDetached">detached</a> подпись. 
</p>
<p>
Enveloped подписи включаются в документ способом, описанным для 
<a href="http://tools.ietf.org/html/rfc4287#section-5.1">Atom-подписей</a>. 
Имеется единая подпись, подписывающая весь фид (например на atom:feed). Применяются обязательства, описанные в спецификации Atom, с оговоркой, что atom:source не применяется для Документов, и, следовательно, нет необходимости создавать элементы atom:source.
</p>
<p>
Подписаны ли документы enveloped или detached подписью, приложениям, обрабатывающим документы, необходимо связывать документ с существующим документом-участником. По этой причине keyName  в подписи ДОЛЖЕН содержать URI, указывающий прямо на один из документов-участников (человек, устройство или организация) с помощью именования ресурса.
</p>
<p>
Если документ представлен в <a href="json.html">JSON</a>, применяются те же самые правила подписей, и подпись представляется описанной для <a href="json.html#sig">JSON</a>.
</p>





<a name="bundle"> </a>
<h2>Конечные точки документа (Document End-Points)</h2>

<p>
Имеется несколько разных RESTful конечных точек, используемых при работе с документами. Использование различных конечных точек лучше всего описать, рассматривая последствия отправки сообщений на них:
</p>
<table class="grid">
 <tr> <td><b>End-Point</b></td> <td><b>Тип содержимого</b></td> <td><b>Описание</b></td> </tr>
 <tr> <td>[baseurl]/Document</td> <td>Document Bundle</td> <td>Это работает так же как и обычная конечная точка для управления типом ресурса, однако это работает с целыми комплектами документов - т. е. операция чтения возвращает комплект, обновление получает комплект и поиск возвращает комплект комплектов. Параметры поиска, доступные этой конечной точке, те же, что и у ресурса композиция из комплекта документов. </td> </tr>
   
 <tr> <td>[baseurl]/Composition</td> <td>Composition Resource</td> <td>Обычная конечная точка для управления ресурсами композиции. Она может использоваться во время комплектации документа или после разбиения документа на свои составные ресурсы или во время использования композиций отдельно от документов.</td> </tr>
   
 <tr> <td><a href="extras.html#binary">[baseurl]/Binary</a></td> <td>Document Bundle</td> <td>Просто сохраняет весь документ в виде последовательности байтов и по запросу возвращает точно эту самую последовательность. Нет способа обнаружить содержимое в конечной точке /Binary, поэтому обычно это ассоциируется с <a href="documentreference.html">Document Reference</a>, чтобы приложения могли найти и обработать документ, хотя это и не обязательно.</td> </tr>
   
 <tr> <td><a href="http.html#transaction">[baseurl]</a> (e.g. a transaction)</td> <td>Document Bundle</td> <td>Игнорирует факт, что комплект - это документ, и обрабатывает все ресурсы, которые он содержит как самостоятельные ресурсы. Клиентам НЕ СЛЕДУЕТ ожидать, что сервер, который получает документ, отправленный с помощью этого метода, будет в состоянии пересобрать документ точно. (Даже если сервер может пересобрать документ (см. ниже), нельзя ожидать, что результат будет в том же порядке и т. п. Соответственно, подпись документа, весьма вероятно, станет недействительной.</td> </tr>
   
 <tr> <td><a href="messaging.html#mailbox">[baseurl]/Mailbox</a></td> <td>Document Bundle</td> <td>Отправка документа на сервер для обработки. Конкретный метод обработки, который совершает сервер, является свободным выбором сервера. Он МОЖЕТ совершить одно или более из этих действий:
  <ul>
    <li>Переслать документ еще куда-то.</li>
    <li>Разбить его на самостоятельно доступные ресурсы и сделать их доступными через RESTful-интерфейс.</li>
    <li>Сохранить документ в его бинарной форме и сделать его доступным по /Binary и, возможно, также создать DocumentReference.</li>
  </ul>
  Сервер не обязан обрабатывать документ каким-то определенным образом. Клиент не знает, какой действие предпримет сервер, только что сервер принял ответственность за документ.
  <br/><br/>
  Профили реализации должны быть внимательны при определении правил о том, что случается, когда документ отправляется в почтовый ящик (mailbox), так как легко принять такие правила, что сервер не сможет соответствовать более чем одному профилю одновременно.
  </td> </tr>
</table>

<p>
Примечание: Несмотря на то, что эти конечные точки определены для использования с ресурсами документа и комплектами документов, их использование не обязательно. Документы можно передавать между системами с помощью любого желаемого способа.
</p>

<h3>Генерация документа</h3>
<p>
Клиент может попросить сервер сгенерировать полностью скомплектованный документ из ресурса композиция. Сервер берет ресурс композицию, локализует все ресурсы, на которые есть ссылки и другие дополнительные ресурсы, как сконфигурировано или требуется и либо возвращается полный комплект документов, либо возвращает ошибку. Обратите внимание, что так как это операция поиска, комплект документов оборачивается в комплект поиска (search bundle).
</p>
<p>
Если некоторые из ресурсов расположены на других серверах, оставляется на выбор сервера, будет ли он  извлекать их или вернет ошибку. Если корректная версия документа, который необходимо сгенерировать, уже существует, тогда сервер может вернуть существующую.
</p>
<p>
Операция инициируется именованным запросом с помощью _query=generate на конечной точке /Document:
</p>
<pre>
  GET [service-url]/Document/?_query=generate&amp;id=:url&amp;...
</pre>
<p>
Параметр "id" - это относительная или абсолютная ссылка на ресурс композиция (например  Composition/1234). Формат документа определяется с помощью соглашения: заголовок или <a href="http.html#mime-type">_format parameter</a>. Могут быть предоставлены и другие параметры:
</p>
<table class="grid">
  <tr> <td><b>Имя</b></td> <td><b>Значение</b></td> </tr>
  <tr> <td>persist</td> <td>Сохранить или нет документ в конечной точке (/Document), после того как он будет сгенерирован. Значение =  true или false (по умолчанию то, которое выбрал сервер).</td> </tr>
  <tr> <td>cert</td> <td>URL сертификата, используемого для подписи документа.</td> </tr>
  <tr> <td>pword</td> <td>Пароль, если сертификат требует его и сервер не знает его по каким-либо причинам. Помещение пароля в URL требует рассмотрения очевидных последствий для безопасности. Альтернатива этому - подписание документа клиентом.</td> </tr>
</table>


</div>

[%file newfooter%]
    
    
</body>
</html>








