<!DOCTYPE HTML>

      
[%settitle Ссылки в ресурсах%]
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
[%file newheader%]
</head>
<body>
[%file newnavbar%]

<div class="col-12">

<%refheader base%>

<a name="Reference"> </a>
<a name="reference"> </a>
<a name="Resource"> </a>
<a name="references"> </a>
<a name="Identification"> </a>
<h2>Ссылки между ресурсами</h2>
<table class="cols"><tr><td id="wg"><a _target="blank" href="[%wg fhir%]">[%wgt fhir%]</a> Рабочая группа</td><td id="fmm"><a href="resource.html#maturity">Уровень готовности</a>: 3</td><td id="ballot"><a href="help.html#status">Статус голосования</a>: <a href="history.html#pubs">DSTU 2</a></td></tr></table>

<p>
Большинство определенных в ресурсе элементов являются ссылками на другие ресурсы. С помощью этих ссылок ресурсы комбинируются для построения сети информации о здравоохранении. 
</p>
<p>
Ресурсы содержат два типа ссылок:
</p>
<ul>
 <li><b>Внутренние "вложенные" ссылки</b> - ссылки на другие ресурсы, заключенные внутри исходного ресурса</li>
 <li><b>Внешние ссылки</b> - ссылки на ресурсы, находящиеся в другом месте</li>
<!--  <li><b>Internal "contained" references</b> - references to other resources packaged inside the source resource</li>
 <li><b>External references</b> - references to resources found elsewhere</li> -->
</ul>
<p>
Ссылки всегда определяются и представляются в одном конкретном направлении - от одного ресурса (источника) к другому (цели). Ссылки указываются в виде URL-адресов, которые могут быть абсолютными или относительными. Алгоритм разрешения ссылок обсуждается ниже.
</p>
<p>
Соответствующая обратная связь от цели к источнику существует в логическом смысле, но не представлена в ресурсе явно. Для внешних ссылок перемещение по таким обратным связям требует от некоторой внешней инфраструктуры отслеживания связей между ресурсами (<a href="http.html">REST API</a> предоставляет такую инфраструктуру, обеспечивая возможность <a href="http.html#search">поиска</a> обратной связи с помощью именования параметров поиска для ссылок, and by providing support for <a href="search.html#revinclude">reverse includes</a>).
</p>
<p>
Т. к. ресурсы обрабатываются независимо, взаимосвязи не считаются переходными. Например, если ресурс <a href="condition.html">Condition</a> ссылается на конкретного 
<a href="patient.html">Patient</a> в качестве своего объекта и ссылается на ресурс <a href="procedure.html">Procedure</a>
в качестве его основания, то нет автоматического правила или вывода, что эта процедура в качестве своего объекта ссылается на того же самого пациента. Напротив, объект процедуры должен устанавливаться непосредственно в самм ресурсе Procedure. 
Другими словами, контекст объекта не "наследуется" и не "вытекает" из связи с процедурой. Единственное исключение этому - случай вложенных ресурсов (см. ниже). Обратите внимание, что на практике эти взаимосвязи действительно должны описывать логическую и не противоречивую запись, и в описанном здесь примере с Condition и Procedure они, как правило, должны будут  иметь одного пациента в качестве объекта.
</p>

<p>
В ресурсе ссылки обозначаются ссылкой и текстовым описанием. Ключевым элементом является <i>reference</i>: ресурсы идентифицируются и адресуются с помощью URL-ссылок. Реальная ссылка выглядит так:
</p>

[%dt Reference 1%]

<p>&nbsp;</p>

<div class="use">
<p><b>Constraints</b></p>
<p>
[%dt.constraints Reference%]
</p>

</div>

<p>Примечания:</p>
<ul>
 <li>Элемент <code>reference</code> содержит URL, являющийся либо:
   <ul>
     <li>абсолютным URL</li>
     <li>относительным URL по отношению к <a href="http.html#root">служебному базовому URL</a> или, в комплекте, <code>Bundle.entry.fullUrl</code> (см. <a href="bundle.html#references">Resolving References in Bundles</a>)</li>
     <li>внутренней ссылкой на фрагмент (см. "Вложенные ресурсы" ниже)</li>
   </ul>
 </li>
 <a name="regex"> </a>
 <li>Использование абсолютных URL адресов обеспечивает стабильный, масштабируемый подход, подходящий для облачного/веб окружения, в то время как использование относительных/логических ссылок обеспечивает гибкий подход, подходящий для использования при торговле через границы закрытых экосистем (см. <a href="implementation.html#identity">проблемы реализации</a> для дальнейшего обсуждения)</li>
 <li>Абсолютные URL-адреса не обязательно должны указывать на  <a href="http.html">FHIR RESTful сервер</a>, хотя это и предпочтительный подход. Ведет ли ссылка на FHIR RESTful сервер или нет, она ДОЛЖНА указывать на Ресурс как определено в данной спецификации.
	<br/>Примечание: данное регулярное выражение будет выполняться, если ссылка на ресурс соответствует FHIR API: 
	<!-- Note: This regex is true if the reference to a resource is consistent with a FHIR API: -->
   <pre>
   ((http|https)://([A-Za-z0-9\\\/\.\:\%\$])*)?([%piperesources%])\/[%id_regex%](\/_history\/[%id_regex%])?
   </pre>
   <br/>
   Однако соответствие этому регулярному выражению не является гарантией того, что конечной точкой будет сервер FHIR
  <!--  However conformance with this regex is no guarantee that the end-point is a FHIR server -->
	</li>
 <li>URL-адреса всегда считаются чувствительными к регистру.</li>
 <li>Элемент <code>display</code>, если заполнен, не имеет идентичного содержимого в Resource.text ссылаемого ресурса. Его цель  - обозначить, на что идет ссылка, а не более полно описать это.</li>
</ul>

<div class="example">
<p>Относительная ссылка на <a href="patient.html">пациента</a> "034AB16"  в элементе <code>context</code> на FHIR RESTful сервере:</p>
<pre class="xml" fragment="Reference">
  &lt;context&gt;
    &lt;reference value="Patient/034AB16" /&gt;
  &lt;/context&gt;
</pre>
<p>Абсолютная ссылка на <a href="structuredefinition.html">Structure Definition</a> в элементе <code>profile</code>:</p>
<pre class="xml" fragment="Reference">
  &lt;profile&gt;
    &lt;reference value="http://fhir.hl7.org/svc/StructureDefinition/c8973a22-2b5b-4e76-9c66-00639c99e61b" /&gt;
  &lt;/profile&gt;
</pre>
<p><i>Обратите внимание, что в действительности HL7 пока что не создал ни реестр профилей, ни URL-адрес для него</i>.</p>
<p>
В элементе display можно задать короткий текст с человекочитаемым описанием ресурса:
</p>
<pre class="xml" fragment="Reference">
  &lt;custodian&gt;
    &lt;reference value="Organization/123" /&gt;
    &lt;display value="HL7, Inc" /&gt;
  &lt;/custodian&gt;
</pre>
<p>
Этот текст может использоваться системой, которая не в состоянии разрешить ссылку непосредственно на сам ресурс.
</p>
</div>
<p>
Note that some elements have the type <a href="datatypes.html#uri"><code>uri</code></a> instead of <code>Reference</code>.
URIs may point to resources, to elements inside a resource by their <code>id</code> property, or (most often)
to some other content that is not a resource. The Reference type is only used to refer to resources
directly, by their logical id.
</p>

<a name="contained"> </a>
<h3>Вложенные ресурсы</h3>
<p>
В некоторых обстоятельствах содержимое, на которое ссылаются в ссылке на ресурс, не существует отдельно от ресурса, в который оно вложено: оно не может быть идентифицировано независимо и не может иметь своей собственной независимой области транзакций. Обычно такие ситуации возникают, когда ресурсы собираются вторичным пользователем источника данных, таким как межплатформенный механизм (middleware engine). Если данные, доступные во время построения ресурса, не содержат ключей записи или информации об абсолютной идентификации, тогда не возможно собрать правильно идентифицированный ресурс, и даже если с ним была ассоциирована свободная идентификация, ресурс никогда не сможет быть объектом транзакции вне контекста ресурса, который на него ссылается.
</p>
<p>
Например рассмотрим ситуацию, когда механизм интерфейса создает запись <a href="condition.html">Condition</a>
для пациента из сообщения <a href="http://www.hl7.org/implement/standards/product_brief.cfm?product_id=185">HL7 v2</a>, и единственная информация о главном хирурге (primary surgeon) - это ее имя и фамилия (REL-7.2 и RES-7.3). В отсутствие контролируемого каталога врачей этой информации не достаточно для создания идентифицированного ресурса <a href="practitioner.html">Practitioner</a> - несколько врачей могут иметь одинаковые имена. 
</p>
<p>
В таких случаях ресурс размещается непосредственно внутри другого ресурса инлайн. <b>Этого не следует делать, когда содержимое может быть должным образом идентифицировано, поскольку однажды потеряв возможность его идентифицировать, будет чрезвычайно сложно (и контекстно-зависимо) снова восстановить ее.</b>
</p>
<div class="example">
<p>
Пример вложенного ресурса:
</p>
<pre class="xml"> <!-- Can't fragment test this - too incomplete -->
 &lt;Composition xmlns="http://hl7.org/fhir"&gt;
  &lt;extension&gt;...&lt;/extension&gt;
  &lt;text&gt;...&lt;/text&gt;
  &lt;contained&gt;
    &lt;Organization&gt;
      &lt;id value=&quot;org1&quot;/&gt;
      &lt;!-- whatever information is available --&gt;
    &lt;/Organization&gt;
  &lt;/contained&gt;
  &lt;information&gt;
    &lt;!-- other attributes --&gt;
    &lt;custodian&gt;
      &lt;reference value="#org1" /&gt;
    &lt;/custodian&gt;
    &lt;!-- other attributes --&gt;
  &lt;information&gt;
 &lt;/Composition&gt;
</pre>
<p>
Этот же пример в JSON-формате:
</p>
<pre class="json"> 
{ "resourceType" : "Composition",
  "extension" : { ... },
  "text" : { .. },
  "contained: [
    {
      "resourceType" : "Organization",
      "id" : "org1",
      .. whatever information is available ...
	}  ]
  "information: {
    ... other attributes ...
    "custodian" : {
      "reference" : "#org1"
	}
    ... other attributes ...
  }
}
</pre>
</div>
<blockquote>
<div class="design-note">
<p>
Примечание разработчика: Вложенные ресурсы по-прежнему остаются ссылками, вместо того чтобы встраиваться непосредственно в элемент-ссылку (например "custodian" выше), чтобы гарантировать возможность использования единого подхода к разрешению ссылок на ресурсы. Хотя прямое включение и кажется проще, было бы все еще необходимо поддерживать внутренние ссылки, где на один и тот же содержащийся внутри ресурс могут ссылаются более одного раза. В конечном счете всё, чего бы мы достигли этим, это создание дополнительных опций синтаксиса. Для пользователей, применяющих XPath для обработки ресурса, следующий фрагмент XPath разрешается во внутреннюю ссылку:
</p>
<pre>
ancestor::f:*[not(parent::f:*)]/f:contained/*[@id=substring-after(<b>current()</b>/f:reference/@value, '#')]
</pre>
</div>
</blockquote>
<p>
Некоторые примечания к использованию и интерпретации вложенных ресурсов:
</p>

<ul>
  <li>Элемент <code>contained</code> НЕ ДОЛЖЕН иметь расширений (хотя вложенные ресурсы могут содержать расширения)</li>
  <li>Вложенные ресурсы разделяют одно пространство разрешения внутренних id, что и родительский ресурс (for id attributes, see below)</li>
  <li>Вложенные ресурсы НЕ ДОЛЖНЫ содержать других вложенных ресурсов</li>
  <li>Вложенные ресурсы НЕ ДОЛЖНЫ содержать описательную часть (narrative)</li>
  <li>Вложенный ресурс ДОЛЖЕН БЫТЬ включен в другой ресурс, только если что-то в этом ресурсе (возможно другой вложенный ресурс) ссылается на него:
<!--
  <li>The <code>contained</code> element SHALL NOT have extensions on it (though contained resources can still contain extensions)</li>
  <li>Contained resources share the same internal id resolution space as the parent resource (for id attributes, see below)</li>
  <li>Contained resources SHALL NOT contain additional contained resources</li>
  <li>Contained resources SHALL NOT contain any narrative</li>
  <li>A contained resource SHALL only be included in a resource if something in that resource (potentially another contained resource) has a reference to it</li>
-->
</li>
</ul>
<p>
Resources that are contained inline do not "inherit" context from their parent resource. For instance, if
the parent resource contains a "subject", and the contained resource also has a "subject" element defined,
there is no implication that the contained resource has the same subject as the parent resource.
</p>

<p>
Resources can only be contained in other resources if there is a reference from the resource to 
the contained resource. This is intended to ensure that the meaning of the contained resource
is clear, and that there is no confusion as to its significance. 
</p>
    
<blockquote class="dstu-note">
<a name="dstu"> </a>
<p>
<b>DSTU Note:</b> There are some identified use cases where it would be useful to include resources that refer
to the contained resource rather than the container referring to the contained resource, but this 
has a series of structural ramifications for the API. Whether these can be resolved is an open 
issue for investigation during the period of trial use.
</p>
<p>
Feedback is welcome <a href="http://wiki.hl7.org/index.php?title=FHIR_Specification_Feedback_(DSTU_2)">here</a>.
</p>
</blockquote>

</div>

[%file newfooter%]

  <script src="external/jquery/jquery.js"> </script>
<script src="jquery-ui.min.js"> </script>
<script>
 try {
   var currentTabIndex = sessionStorage.getItem('fhir-resource-tab-index');
 } catch(exception){ 
 }
 if (!currentTabIndex)
   currentTabIndex = '0';

$( '#tabs-Reference' ).tabs({ active: currentTabIndex, activate: function( event, ui ) { store(ui.newTab.index()); } });
     
     
function store(currentTab) {
  document.activeElement.blur();
  try {
    sessionStorage.setItem('fhir-resource-tab-index', currentTab);
  } catch(exception){ 
  }
  $( '#tabs-Reference' ).tabs('option', 'active', currentTab);
}     
</script>


</body>
</html>
