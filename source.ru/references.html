<!DOCTYPE HTML>


      
[%settitle Ссылки в ресурсе%]
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
[%file newheader%]
</head>
<body>
[%file newnavbar%]

<div class="col-9">

<h2>Ссылки в ресурсе</h2>

<p>
Ресурсы содержат два типа ссылок:
</p>
<ul>
 <li><b>Внутренние ссылки</b> - ссылки между элементами в ресурсе</li>
 <li><b>Внешние ссылки</b> - ссылки из одного ресурса на другой</li>
</ul>

<a name="idref"></a>
<a name="id"></a>
<h3>Внутренние ссылки</h3>
<p>
Есть 3 случая, когда элементы внутри ресурса ссылаются друг на друга:
</p>
<p><b>Между ResourceReference и вложенным ресурсом</b><br />
Элемент ссылки типа ResourceReference ссылается на идентификатор вложенного ресурса с помощью идентификатора фрагмента относительно ресурса.
<em>См. пример ниже под 'Contained Resources'.</em></p>

<p><b>Между элементами в описательной части и элементами структурированных данных</b><br />
Осуществляется с помощью подхода на основе id/idref, где элемент-источник указывает, что он имеет то же самое содержимое, что и целевой элемент. Все ссылки между XHTML-элементами и элементами данных должны быть согласованы для установления связи "получено из", где полученное содержимое (текст либо данные) ссылается на содержимое источника. Обратите внимание, это означает, что некоторые ссылки могут быть опережающими (ссылками на элементы, определенные в экземпляре позже):</p>
<pre class="xml">
&lt;Patient xmlns=&quot;http://hl7.org/fhir&quot;&gt;
  &lt;text&gt;
    &lt;status value=&quot;generated&quot;/&gt;
    &lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
      &lt;p&gt;... &lt;span idref=&quot;dob&quot;/&gt;30-11-1972&lt;/span&gt;
    &lt;/div&gt;
  &lt;/text&gt;
  &lt;birthDate id=&quot;dob&quot; value=&quot;1972-11-30&quot; /&gt;
</pre>

<p><b>Ссылка вида &lt;img src=""/&gt; в описательной части</b><br />
Источник изображения может ссылаться на изображение, находящееся в ресурсе (как например вложенный <a href="media.html">Media</a> или <a href="extras.html#binary">Binary</a> ресурс):</p>
<pre class="xml">
&lt;Patient xmlns=&quot;http://hl7.org/fhir&quot;&gt;
  &lt;text&gt;
    &lt;status value=&quot;generated&quot;/&gt;
    &lt;div xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
      &lt;p&gt;... &lt;img src=&quot;#pic1&quot;/&gt;. ....&lt;/p&gt;
    &lt;/div&gt;
  &lt;/text&gt;
  &lt;contained&gt;
    &lt;Binary id=&quot;pic1&quot; contentType=&quot;image/gif&quot;&gt;MEKH....SD/Z&lt;/Binary&gt;
  &lt;/contained&gt;
</pre>

<p>
Во всех трех случаях целевой элемент имеет атрибут "id", который ДОЛЖЕН иметь уникальное значение <em>внутри ресурса</em> по отношению к любым другим атрибутам id: уникальность и область идентификации этих id-ссылок лежит внутри ресурса, который их содержит. Если несколько ресурсов скомбинированы в единый фрагмент XML, такой как фид в формате Atom<a href="xml.html#atom">atom feed</a>, в ресурсах могут возникнуть значения-дубликаты. Это ДОЛЖНО регулироваться приложениями, обрабатывающими ресурсы. Атрибут "id" не находится ни в каком пространстве имен. Ссылка элемента source ДОЛЖНА ссылаться на атрибут в том же самом ресурсе. 
</p>
<p>
Обратите внимание, что внутренние ссылки работают в JSON точно так же, основываясь на JSON-свойстве id, которое эквивалентно XML-атрибуту "id".
</p>

<a name="ResourceReference"> </a>
<a name="resourcereference"> </a>
<a name="Resource"> </a>
<a name="references"> </a>
<a name="Identification"> </a>
<h3>Ссылки между ресурсами</h3>
<p>
Большинство определенных в ресурсе элементов являются ссылками на другие ресурсы. С помощью этих ссылок ресурсы комбинируются для построения сети информации о здравоохранении. 
</p>
<p>
Ссылки всегда определяются и представляются в одном конкретном направлении - от одного ресурса (источника) к другому (цели). Ссылки указываются в виде URL-адресов, которые могут быть абсолютными или относительными. Алгоритм разрешения ссылок обсуждается ниже.
</p>
<p>
Соответствующая обратная связь от цели к источнику существует в логическом смысле, но не представлена в ресурсе явно. Перемещение по таким обратным связям требует от некоторой внешней инфраструктуры отслеживать связи между ресурсами (<a href="http.html">REST API</a> предоставляет такую инфраструктуру, обеспечивая возможность <a href="http.html#search">поиска</a> обратной связи с помощью именования параметров поиска для ссылок).
</p>
<p>
Т.к. ресурсы обрабатываются независимо, взаимосвязи не считаются переходными. Например, если ресурс <a href="condition.html">Condition</a> ссылается на конкретного 
<a href="patient.html">Patient</a> в качестве своего объекта и связан с ресурсом <a href="procedure.html">Procedure</a>
в качестве его основания, то нет автоматического правила или вывода, что эта процедура в качестве своего объекта ссылается на того же самого пациента. Напротив, объект процедуры должен устанавливаться непосредственно в самой процедуре. 
Другими словами, контекст объекта не "наследуется" и не "вытекает" из связи с процедурой. Единственное исключение этому - в случае вложенных ресурсов (см. ниже). Обратите внимание, что на практике эти взаимосвязи действительно должны описывать логическую и не противоречивую запись, и в описанном здесь примере с Condition и Procedure они, как правило, должны будут  иметь одного пациента в качестве объекта.
</p>

<p>
В ресурсе ссылки обозначаются ссылкой и текстовым описанием. Ключевым элементом является <i>reference</i>: ресурсы идентифицируются и адресуются с помощью URL-ссылок. Реальная ссылка выглядит так:
</p>

[%dt ResourceReference%]

<p>&nbsp;</p>

<p>Примечания:</p>
<ul>
 <li>Элемент <i>reference</i> содержит URL, являющийся либо:
   <ul>
     <li>абсолютным URL</li>
     <li>относительным URL по отношению к <a href="http.html#root">служебному базовому URL</a> или, в комплекте, <a href="#atom-refs">контекстом комплекта</a></li>
     <li>внутренней ссылкой на фрагмент (см. "Вложенные ресурсы" ниже)</li>
   </ul>
 </li>
 <li>Использование абсолютных URL адресов обеспечивает стабильный масштабируемый подход, подходящий для облачного/веб окружения, в то время как использование относительных/логических ссылок обеспечивает гибкий подход, подходящий для использования при торговле через границы закрытых экосистем (см. <a href="use.html#identity">проблемы реализации для дальнейшего обсуждения</a>)</li>
 <li>Абсолютные URL-адреса не обязательно должны указывать на  <a href="http.html">FHIR RESTful сервер</a>, хотя это и предпочтительный подход. Ведет ли ссылка на FHIR RESTful сервер или нет, она ДОЛЖНА указывать на Ресурс как определено в данной спецификации.</li>
 <li>URL-адреса всегда считаются чувствительными к регистру.</li>
 <li>Элемент <i>display</i>, если заполнен, в основном не имеет идентичного содержимого в Resource.text ссылаемого ресурса. Его цель  - обозначить, на что идет ссылка, а не более полно описать это.</li>
</ul>

<div class="use">
<p><b>Ограничения</b></p>
<p>
[%dt.constraints ResourceReference%]
</p>
</div>

<div class="example">
<p>Относительная ссылка на <a href="patient.html">пациента</a> "034AB16"  в элементе "context" на FHIR RESTful сервере:</p>
<pre class="xml" fragment="ResourceReference">
  &lt;context&gt;
    &lt;reference value="Patient/034AB16" /&gt;
  &lt;/context&gt;
</pre>
<p>Абсолютная ссылка на <a href="profile.html">профиль ресурса</a> в элементе "profile":</p>
<pre class="xml" fragment="ResourceReference">
  &lt;profile&gt;
    &lt;reference value="http://fhir.hl7.org/svc/Profilec8973a22-2b5b-4e76-9c66-00639c99e61b" /&gt;
  &lt;/profile&gt;
</pre>
<p><i>Обратите внимание, что в действительности HL7 пока что не создал ни реестр профилей, ни URL-адрес для него</i>.</p>
<p>
В элементе display можно задать короткий текст с человекочитаемым описанием ресурса:
</p>
<pre class="xml" fragment="ResourceReference">
  &lt;custodian&gt;
    &lt;reference value="Organization/123" /&gt;
    &lt;display value="HL7, Inc" /&gt;
  &lt;/custodian&gt;
</pre>
<p>
Этот текст может использоваться системой, которая не в состоянии разрешить ссылку непосредственно на сам ресурс.
</p>
</div>

<a name="contained"> </a>
<h3>Вложенные ресурсы</h3>
<p>
В некоторых обстоятельствах содержимое, на которое ссылаются в ссылке на ресурс, не существует отдельно от ресурса, в который оно вложено: оно не может быть идентифицировано независимо и не может иметь своей собственной независимой области транзакций. Обычно такие ситуации случаются, когда ресурс собирается вторичным пользователем источника данных, таким как межплатформенный механизм (middleware engine). Если данные, доступные во время построения ресурса, не содержат ключей записи или информации об абсолютной идентификации, тогда не возможно собрать правильно идентифицированный ресурс, и даже если с ним была ассоциирована свободная идентификация, ресурс никогда не сможет быть объектом транзакции вне контекста ресурса, который на него ссылается.
</p>
<p>
Например рассмотрим ситуацию, когда механизм интерфейса создает запись <a href="condition.html">Condition</a>
для пациента из сообщения HL7 v2, и единственная информация о главном хирурге (primary surgeon) - это ее имя и фамилия (REL-7.2 и RES-7.3). В отсутствие контролируемого каталога врачей этой информации не достаточно для создания идентифицированного ресурса <a href="practitioner.html">Practitioner</a>: несколько врачей могут иметь одинаковые имена. 
</p>
<p>
В таком случае ресурс помещается прямо внутрь другого ресурса. <b>Этого не следует делать, когда содержимое может быть должным образом идентифицировано, поскольку однажды потеряв возможность его идентифицировать, будет чрезвычайно сложно (и контекстно-зависимо) снова восстановить ее.</b>
</p>
<div class="example">
<p>
Пример вложенного ресурса:
</p>
<pre class="xml"> <!-- Can't fragment test this - too incomplete -->
 &lt;Document xmlns="http://hl7.org/fhir"&gt;
  &lt;extension&gt;...&lt;/extension&gt;
  &lt;text&gt;...&lt;/text&gt;
  &lt;contained&gt;
    &lt;Organization id=&quot;org1&quot;&gt;
      &lt;!-- whatever information is available --&gt;
    &lt;/Organization&gt;
  &lt;/contained&gt;
  &lt;information&gt;
    &lt;!-- other attributes --&gt;
    &lt;custodian&gt;
      &lt;reference value="#org1" /&gt;
    &lt;/custodian&gt;
    &lt;!-- other attributes --&gt;
  &lt;information&gt;
 &lt;/Document&gt;
</pre>
<p>
Этот же пример в JSON-формате:
</p>
<pre class="json"> 
{ "resourceType" : "Document",
  "extension" : { ... },
  "text" : { .. },
  "contained: [
    { "resourceType" : "Organization",
      "id" : "org1",
      .. whatever information is available ...
	}  ]
  "information: {
    ... other attributes ...
    "custodian" : {
      "reference" : "#org1"
	}
    ... other attributes ...
  }
}
</pre>
</div>
<blockquote>
<div class="design-note">
<p>
Примечание разработчика: Вложенные ресурсы по-прежнему остаются ссылками, вместо того чтобы встраиваться непосредственно в элемент-ссылку (например "custodian" выше), чтобы гарантировать возможность использования единого подхода к разрешению ссылок на ресурсы. Хотя прямое включение и кажется проще, было бы все еще необходимо поддерживать внутренние ссылки, где на один и тот же содержащийся внутри ресурс могут ссылаются более одного раза. В конечном счете всё, чего бы мы достигли этим, это создание дополнительных опций синтаксиса. Для пользователей, применяющих XPath для обработки ресурса, следующий фрагмент XPath разрешается во внутреннюю ссылку:
</p>
<pre>
ancestor::f:*[not(parent::f:*)]/f:contained/*[@id=substring-after(<b>current()</b>/f:reference/@value, '#')]
</pre>
</div>
</blockquote>
<p>
Некоторые примечания к использованию и интерпретации вложенных ресурсов:
</p>

<ul>
  <li>Вложенные ресурсы разделяют одно пространство разрешения внутренних id, что и родительский ресурс.</li>
  <li>Вложенные ресурсы НЕ ДОЛЖНЫ содержать других вложенных ресурсов.</li>
  <li>Вложенные ресурсы НЕ ДОЛЖНЫ содержать никакого текстового описания.</li>
  <li>Ресурсы, содержащиеся внутри, также "наследуют" контекст от их родительского ресурса. Например, если родительский ресурс содержит "subject", и вложенный ресурс также имеет определенный элемент subject, но не указывает никакого объекта, обрабатывающее приложение может заключить, что объект тот же самый. Обратите внимание, однако, что подобные заключения являются специфичными для конкретной ситуации. Нет правила, к примеру, что значение элемента "subject" совпадает в родительском и вложенном ресурсах.</li>
</ul>

<a name="atom-refs"> </a>
<h3>Разрешение ссылок на ресурсы в Комплектах</h3>
<p>
При обработке комплектов приложениям при обнаружении <a href="#Resource">ссылки на ресурс</a> всегда следует искать ресурсы сначала в этом комплекте.
</p>
<h4>Абсолютные ссылки</h4>
<div class="example">
<pre class="xml" fragment="ResourceReference">
  &lt;institution&gt;
    &lt;reference value="http://example.org/Organization/23" /&gt;
  &lt;/institution&gt;
  &lt;institution&gt;
    &lt;reference value="http://example.org/Organization/ex/history/2" /&gt;
  &lt;/institution&gt;
</pre>
</div>
<p>
тогда приложению следует искать любую запись в комплекте, где либо entry.id, либо entry.link[self] точно совпадает с URL-ссылкой:
</p>
<div class="example">
<pre class="xml">
   .. feed ..
  &lt;entry>
    .. 
    &lt;id>http://example.org/Organization/23&lt;id>
    .. 

    &lt;content type="text/xml">
      &lt;Organization xmlns="http://hl7.org/fhir">
         &lt;!-- Content for the resource --&gt;
      &lt;/Organization>
    &lt;/content>

  &lt;entry>
    .. 
    &lt;link rel="self" href="http://example.org/Organization/ex/history/2&lt;"/>
    .. 

    &lt;content type="text/xml">
      &lt;Organization xmlns="http://hl7.org/fhir">
         &lt;!-- Content for the resource --&gt;
      &lt;/Organization>
    &lt;/content>
    ... feed ...
</pre>
</div>
<p>
Во втором случае совпадение основано на конкретной версии ресурса. Приложениям следует проверять оба entry.id и self-ссылку, только один из двух может иметь совпадение. Если ссылка на ресурс не может быть разрешена внутри комплекта, приложение ДОЛЖНО иметь возможность получить ресурс, следуя прямо по приведенной URL-ссылке. Если это невозможно, ему придется использовать некоторый другой, специфичный для реализации, метод поиска ресурса.
</p>
<p>
Обратите внимание, что внутренние ссылки могут быть URI, а не буквальными URL. Типичным примером является использование <a href="http.html#transaction">cid: URI в транзакции</a>.
</p>
<a name="atom-rel"> </a>
<h4>Относительные ссылки</h4>
<p>
Если ссылка на ресурс является относительным URL, применяется тот же базовый принцип: сначала попытка разрешить ссылку в комплекте, затем поиск вне его. Однако перед тем, как это можно будет сделать, относительный URL должен быть преобразован в абсолютный URL, а для этого должен быть известен логический служебный базовый URL. Это представлено в ссылке с именем "fhir-base" в самом фиде:
</p>
<div class="example">
<pre class="xml">
&lt;feed xmlns="http://www.w3.org/2005/Atom">

  &lt;link rel="fhir-base" href="http://example.org"/>

  &lt;entry>
    &lt;id>http://example.org/Organization/23&lt;id>
    .. 

    &lt;content type="text/xml">
      &lt;Organization xmlns="http://hl7.org/fhir">
         &lt;!-- Content for the resource --&gt;
      &lt;/Organization>
    &lt;/content>

  &lt;entry>
    .. 
    &lt;link rel="self" href="http://example.org/Practitioner/example"/>
    .. 

    &lt;content type="text/xml">
      &lt;Practitioner xmlns="http://hl7.org/fhir">
         &lt;!-- Content for the resource --&gt;
           &lt;institution&gt;
             &lt;reference value="Organization/23" /&gt;
           &lt;/institution&gt;
         &lt;!-- Content for the resource --&gt;

      &lt;/Practitioner>
    &lt;/content>
    ... feed ...
</pre>
</div>
<p>
Когда приложение обнаруживает ссылку "Organization/23", оно ищет URL с типом "fhir-base", которым является 
http://example.org. <a href="http.html#root">Базовый служебный URL указывается без слеша в конце</a>,
приложение затем соединяет эти два значения, добавляя "/" между ними, получая абсолютную ссылку "http://example.org/Organization/23", которую она может разрешить в этом комплекте. Примечание: для JSON-комплектов применяется этот же метод.
</p>
<p>
Чтобы позволить обрабатывать должным образом относительные URL, в ссылках комплекта ДОЛЖНА быть указана ссылка с типом "fhir-base", если хоть в одном из ресурсов комплекта имеются относительные ссылки.
</p>
<p>
Обратите внимание, что приложению НЕ СЛЕДУЕТ предполагать, что базовый служебный корневой элемент является фактически разрешимым. В некоторых обстоятельствах он действительно будет. Если комплект был просто получен с сервера как результат поиска или действий с историей, служебный корневой URL ДОЛЖЕН совпадать с URL, который использовал клиент (правило может нарушаться при использовании различных прокси-серверов). Однако в других обстоятельствах, когда сам комплект выступает объектом обмена и/или сохраняется в качестве объекта сам по себе (например <a href="documents.html">клинический документ</a>), служебный корневой URL будет просто логической конструкцией, которую содержит комплект для разрешения ресурсов, и не будет иметь значения вне этого комплекта.
</p>

</div>

[%file newfooter%]
</body>
</html>
