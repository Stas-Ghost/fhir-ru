<Profile xmlns="http://hl7.org/fhir" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://hl7.org/fhir ../../schema/profile.xsd">
  <!-- text will be generated by bild program -->
  
  <url value="http://ihc.org/fhir/Profile/PotassiumSCncPtSerPlasBldQnLabObs "/>
  <!-- stuff from metadata of CDL -->
  <version value="6.6"/>
  <name value="PotassiumSCncPtSerPlasBldQnLabObs"/>
  <publisher value="IHC"/>
  <description value="the Clinical Element Model for standard laboratory test results/observations numeric results"/>
  <status value="active"/>
  <experimental value="false"/>
  <date value="2010-01-19"/>

  <mapping>
    <!-- set up a formal mapping for the CDL Keys -->
    <identity value="cdl.key"/>
    <uri value="http://clinicalelement.com/cdl/key"/>
    <name value="CEM Key for the element"/>
  </mapping>
  
  <structure>
    <!-- this is a profile on Observation -->
    <type value="Observation"/>
    
    <!-- this is deried from the StandardLabObsQuantitative -->
    <base value="http://ihc.org/fhir/Profile/StandardLabObsQuantitative"/> 

    <!-- actually, this name is useless, but it's here right now as a publishing requirement (tooling limtiation to be addressed -->
    <name value="StandardLabObsQuantitative"/>
    
    <!-- this is the constraint the profile expresses publically. other constraint statements below (if any) are in support of this, and are not used directly -->
    <publish value="true"/>
    
    <!-- The infrastructure will generate the snapshot for us
    <snapshot/>
    -->
    
    <differential>
    
    <!-- 
     from the CDL - decisions about how to map 
        key code(PotassiumSCncPtSerPlasBldQn_KEY_ECID);                                    : Observation.name
        constraint primaryPQValue.unit.domain (SubstanceConcentrationUnits_VALUESET_ECID); : Observation.value
        constraint primaryPQValue.unit.normal (MillimolesPerLiter_ECID);                   : Observation.value   
    -->
    
      <element>
        <path value="Observation"/>
      </element>

      <element>
        <path value="Observation.name"/>
        <!-- all we do here is make the key binding -->
        <definition>
          <!-- this is a value set with a single code in it. 
              we could make this a fixed value, but that exludes the 
              ability to have e.g. LOINC codes as well. So it's a binding to a single code, and 
              observation.name has to have at least one code with this present
          -->
          <binding>
            <name value="PotassiumSCncPtSerPlasBldQn_KEY_ECID"/>
            <isExtensible value="false"/>
            <referenceResource>
              <reference value="ValueSet/PotassiumSCncPtSerPlasBldQn_KEY_ECID"/>
            </referenceResource>
          </binding>
          <mapping>
            <identity value="cdl.key"/>
            <map value="PotassiumSCncPtSerPlasBldQn_KEY_ECID"/>
          </mapping>
        </definition>
      </element>
      
      <element>
        <path value="Observation.value[x]"/>
        <name value="non-null"/> <!-- only constraining the non-null case in the parent -->
        <definition>
          <!-- I don't know whether this is what constraint primaryPQValue.unit.normal means -->
          <constraint>
            <key value="1"/>
            <severity value="warning"/>
            <human value="Unit should be mmol/L"/>
            <xpath value="f:unit/@value = 'mmol/L'"/>
          </constraint>
          <!-- this binding says that the units on the quantity must come out of the SubstanceConcentrationUnits value set -->
          <binding>
            <name value="SubstanceConcentrationUnits_VALUESET_ECID"/>
            <isExtensible value="false"/>
            <referenceResource>
              <reference value="ValueSet/SubstanceConcentrationUnits_VALUESET_ECID"/>
            </referenceResource>
          </binding>
        </definition>
      </element>
    </differential>
  </structure>

</Profile>

